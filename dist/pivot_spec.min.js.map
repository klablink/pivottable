{"version":3,"sources":["pivot_spec.js"],"names":["fixtureData","raggedFixtureData","name","colour","age","gender","describe","let","table","beforeEach","done","$","pivotUI","onRefresh","multiple","parametersActive","it","expect","find","length","toBe","val","text","join","data","rows","cols","aggregatorName","vals","rendererName","pivot","sortAs","derivers","aggregators","pivotUtilities","aggregator","filter","record","derivedAttributes","birthyear","dateFormat","trialbins","bin","sorters","attr","received_PivotData","received_rendererOptions","count2x","push","this","value","format","x","renderer","a","b","addClass","greeting","rendererOptions","agg","getAggregator","headCellRenderer","type","document","createTextNode","dataCellRenderer","sumOverSumOpts","pd","PivotData","tableInput","getRowKeys","toEqual","getColKeys","numNotNull","numNull","r","Array","from","c","records","forEachMatchingRecord","getVal","tpl","aggregatorTemplates","count","countUnique","listUnique","average","sum","min","max","first","last","median","quantile","var","stdev","sumOverSum","naturalSort","sortedArr","NaN","Infinity","slice","sort","numberFormat","nf","scaler","suffix","thousandsSep","decimalSep","prefix","digitsAfterDecimal","Date","fieldsType","date","toISOString","integer","df","binner","toBeNaN","cellRenderers","call","fname"],"mappings":"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","file":"pivot_spec.min.js","sourcesContent":["\nconst fixtureData = [\n    ['name', 'gender', 'colour', 'birthday', 'trials', 'successes'],\n    ['Nick', 'male', 'blue', '1982-11-07', 103, 12],\n    ['Jane', 'female', 'red', '1982-11-08', 95, 25],\n    ['John', 'male', 'blue', '1982-12-08', 112, 30],\n    ['Carol', 'female', 'yellow', '1983-12-08', 102, 14],\n];\n\nconst raggedFixtureData = [\n    { name: 'Nick', 'colour': 'red', 'age': 34 },\n    { name: 'Jane', 'gender': 'female' },\n    { name: 'John', 'gender': 'male', 'age': 12 },\n    { name: 'Jim', 'gender': null, 'age': 12 },\n];\n\ndescribe('$.pivotUI()', function () {\n    describe('with no rows/cols, default count aggregator, default TableRenderer', function () {\n        let table = null;\n\n        beforeEach(done => {\n            table = $('<div>').pivotUI(fixtureData, { onRefresh: done, multiple: false, parametersActive: true });\n        });\n        it('has all the basic UI elements', function (done) {\n            expect(table.find('.pvtUiParameters .pvtAxisContainer').length)\n                .toBe(3);\n            // noinspection DuplicatedCode\n            expect(table.find('.pvtRendererArea').length)\n                .toBe(1);\n            expect(table.find('.pvtVals').length)\n                .toBe(1);\n            expect(table.find('select.pvtRenderer').length)\n                .toBe(1);\n            expect(table.find('select.pvtAggregator').length)\n                .toBe(1);\n            expect(table.find('span.pvtAttr').length)\n                .toBe(6);\n            return done();\n        });\n\n        it('reflects its inputs', function (done) {\n            expect(table.find('.pvtUiParameters .pvtUnused span.pvtAttr').length)\n                .toBe(6);\n            expect(table.find('select.pvtRenderer').val())\n                .toBe('Table');\n            expect(table.find('select.pvtAggregator').val())\n                .toBe('Count');\n            return done();\n        });\n\n        it('renders a table', function (done) {\n            expect(table.find('table.pvtTable').length)\n                .toBe(1);\n            return done();\n        });\n\n\n        describe('its renderer output', function () {\n            it('has the correct type and number of cells', function (done) {\n                expect(table.find('th.pvtTotalLabel').length)\n                    .toBe(1);\n                expect(table.find('td.pvtGrandTotal').length)\n                    .toBe(1);\n                return done();\n            });\n\n            it('has the correct textual representation', function (done) {\n                expect(table.find('table.pvtTable').text())\n                    .toBe(['Totals', '4'].join(''));\n                return done();\n            });\n\n            it('has a correct grand total with data value', function (done) {\n                expect(table.find('td.pvtGrandTotal').text())\n                    .toBe('4');\n                expect(table.find('td.pvtGrandTotal').data('value'))\n                    .toBe(4);\n                return done();\n            });\n        });\n    });\n\n    describe('with rows/cols, sum-over-sum aggregator, Heatmap renderer', function () {\n        let table = null;\n\n        beforeEach(done => table = $('<div>').pivotUI(fixtureData, {\n                rows: ['gender'], cols: ['colour'],\n                aggregatorName: 'Sum over Sum',\n                vals: ['successes', 'trials'],\n                rendererName: 'Heatmap',\n                onRefresh: done,\n                multiple: false,\n                parametersActive: true,\n            },\n        ));\n\n        it('has all the basic UI elements', function (done) {\n            expect(table.find('.pvtAxisContainer').length)\n                .toBe(3);\n            // noinspection DuplicatedCode\n            expect(table.find('.pvtRendererArea').length)\n                .toBe(1);\n            expect(table.find('.pvtVals').length)\n                .toBe(1);\n            expect(table.find('select.pvtRenderer').length)\n                .toBe(1);\n            expect(table.find('select.pvtAggregator').length)\n                .toBe(1);\n            expect(table.find('span.pvtAttr').length)\n                .toBe(6);\n            return done();\n        });\n\n        it('reflects its inputs', function (done) {\n            expect(table.find('.pvtUnused span.pvtAttr').length)\n                .toBe(4);\n            expect(table.find('.pvtRows span.pvtAttr').length)\n                .toBe(1);\n            expect(table.find('.pvtCols span.pvtAttr').length)\n                .toBe(1);\n            expect(table.find('select.pvtRenderer').val())\n                .toBe('Heatmap');\n            expect(table.find('select.pvtAggregator').val())\n                .toBe('Sum over Sum');\n            return done();\n        });\n\n        it('renders a table', function (done) {\n            expect(table.find('table.pvtTable').length)\n                .toBe(1);\n            return done();\n        });\n\n        describe('its renderer output', function () {\n            it('has the correct type and number of cells', function (done) {\n                expect(table.find('th.pvtAxisLabel').length)\n                    .toBe(2);\n                expect(table.find('th.pvtRowLabel').length)\n                    .toBe(2);\n                expect(table.find('th.pvtColLabel').length)\n                    .toBe(3);\n                expect(table.find('th.pvtTotalLabel').length)\n                    .toBe(2);\n                expect(table.find('td.pvtVal').length)\n                    .toBe(6);\n                expect(table.find('td.pvtTotal').length)\n                    .toBe(5);\n                expect(table.find('td.pvtGrandTotal').length)\n                    .toBe(1);\n                return done();\n            });\n\n            it('has the correct textual representation', function (done) {\n                expect(table.find('table.pvtTable').text())\n                    .toBe([\n                            'colour', 'blue', 'red', 'yellow', 'Totals',\n                            'gender',\n                            'female', '0.26', '0.14', '0.20',\n                            'male', '0.20', '0.20',\n                            'Totals', '0.20', '0.26', '0.14', '0.20',\n                        ].join(''),\n                    );\n                return done();\n            });\n\n            it('has a correct spot-checked cell with data value', function (done) {\n                expect(table.find('td.col0.row1').text())\n                    .toBe('0.20');\n                expect(table.find('td.col0.row1').data('value'))\n                    .toBe((12 + 30) / (103 + 112));\n                return done();\n            });\n        });\n    });\n\n    describe('with ragged input', function () {\n        const table = $('<div>').pivotUI(raggedFixtureData, {\n            multiple: false,\n            parametersActive: true,\n            rows: ['gender'],\n            cols: ['age'],\n        });\n\n        it('renders a table with the correct textual representation', () => expect(table.find('table.pvtTable').text())\n            .toBe([\n                    'age', '12', '34', 'null', 'Totals',\n                    'gender',\n                    'female', '1', '1',\n                    'male', '1', '1',\n                    'null', '1', '1', '2',\n                    'Totals', '2', '1', '1', '4',\n                ].join(''),\n            ));\n    });\n});\n\ndescribe('$.pivot()', function () {\n\n    describe('with no rows/cols, default count aggregator, default TableRenderer', function () {\n        const table = $('<div>').pivot(fixtureData);\n\n        it('renders a table', () => expect(table.find('table.pvtTable').length)\n            .toBe(1));\n\n        describe('its renderer output', function () {\n\n            it('has the correct textual representation', () => expect(table.find('table.pvtTable').text())\n                .toBe(['Totals', '4'].join('')));\n\n            it('has a correct grand total with data value', function () {\n                expect(table.find('td.pvtGrandTotal').text())\n                    .toBe('4');\n                return expect(table.find('td.pvtGrandTotal').data('value'))\n                    .toBe(4);\n            });\n        });\n    });\n\n    describe('with rows/cols, sum aggregator, derivedAttributes, filter and sorters', function () {\n        const { sortAs, derivers, aggregators } = $.pivotUtilities;\n        const table = $('<div>').pivot(fixtureData, {\n                rows: ['gender'], cols: ['birthyear'], aggregator: aggregators['Sum'](['trialbins']),\n                filter(record) {\n                    return record.name !== 'Nick';\n                },\n                derivedAttributes: {\n                    birthyear: derivers.dateFormat('birthday', '%y'),\n                    trialbins: derivers.bin('trials', 10),\n                },\n                sorters(attr) {\n                    if (attr === 'gender') {\n                        return sortAs(['male', 'female']);\n                    }\n                },\n            },\n        );\n\n        it('renders a table with the correct textual representation', () => expect(table.find('table.pvtTable').text())\n            .toBe([\n                    'birthyear', '1982', '1983', 'Totals',\n                    'gender',\n                    'male', '110.00', '110.00',\n                    'female', '90.00', '100.00', '190.00',\n                    'Totals', '200.00', '100.00', '300.00',\n                ].join(''),\n            ));\n    });\n\n    describe('with rows/cols, fraction-of aggregator', function () {\n        const { aggregators } = $.pivotUtilities;\n        const table = $('<div>').pivot(fixtureData, {\n                rows: ['gender'],\n                aggregator: aggregators['Sum as Fraction of Total'](['trials']),\n            },\n        );\n\n        it('renders a table with the correct textual representation', () => expect(table.find('table.pvtTable').text())\n            .toBe([\n                    'gender', 'Totals',\n                    'female', '47.8%',\n                    'male', '52.2%',\n                    'Totals', '100.0%',\n                ].join(''),\n            ));\n    });\n\n    describe('with rows/cols, custom aggregator, custom renderer with options', function () {\n        let received_PivotData = null;\n        let received_rendererOptions = null;\n\n        const table = $('<div>').pivot(fixtureData, {\n            rows: ['name', 'colour'], cols: ['trials', 'successes'],\n            aggregator() {\n                return {\n                    count2x: 0,\n                    push() {\n                        return this.count2x += 2;\n                    },\n                    value() {\n                        return this.count2x;\n                    },\n                    format(x) {\n                        return 'formatted ' + x;\n                    },\n                };\n            },\n            renderer(a, b) {\n                received_PivotData = a;\n                received_rendererOptions = b;\n                return $('<div>').addClass(b.greeting).text('world');\n            },\n            rendererOptions: { greeting: 'hithere' },\n        });\n\n        it('renders the custom renderer as per options', () => expect(table.find('div.hithere').length)\n            .toBe(1));\n\n        describe('its received PivotData object', () => it('has a correct grand total value and format for custom aggregator', function () {\n            const agg = received_PivotData.getAggregator([], []);\n            const val = agg.value();\n            expect(val).toBe(8);\n            return expect(agg.format(val)).toBe('formatted 8');\n        }));\n    });\n\n\n    describe('with ragged input', function () {\n        const table = $('<div>').pivot(raggedFixtureData, { rows: ['gender'], cols: ['age'] });\n\n        it('renders a table with the correct textual representation', () => expect(table.find('table.pvtTable').text())\n            .toBe([\n                    'age', '12', '34', 'null', 'Totals',\n                    'gender',\n                    'female', '1', '1',\n                    'male', '1', '1',\n                    'null', '1', '1', '2',\n                    'Totals', '2', '1', '1', '4',\n                ].join(''),\n            ));\n    });\n});\n\ndescribe('$.pivot()', function () {\n    var table = $('<div>').pivot(fixtureData, {\n        multiple: false,\n        rows: ['gender'],\n        cols: ['colour'],\n        aggregatorName: ['Count'],\n        rendererOptions: {\n            headCellRenderer: function (value, type) {\n                return document.createTextNode('h_' + type + '_' + value);\n            },\n            dataCellRenderer: function (value) {\n                return document.createTextNode('d_' + value);\n            },\n        },\n    });\n\n    it('renders a table with the correct textual representation', function () {\n        expect(table.find('table.pvtTable').text()).toBe([\n            'colour', 'h_colour_blue', 'h_colour_red', 'h_colour_yellow', 'Totals',\n            'gender',\n            'h_gender_female', 'd_', 'd_1', 'd_1', 'd_2',\n            'h_gender_male', 'd_2', 'd_', 'd_', 'd_2',\n            'Totals', 'd_2', 'd_1', 'd_1', 'd_4',\n        ].join(''));\n    });\n});\n\ndescribe('$.pivotUtilities', function () {\n\n    describe('.PivotData()', function () {\n        const sumOverSumOpts =\n            { aggregator: $.pivotUtilities.aggregators['Sum over Sum'](['a', 'b']) };\n\n        describe('with no options', function () {\n            const aoaInput = [['a', 'b'], [1, 2], [3, 4]];\n            const pd = new $.pivotUtilities.PivotData(aoaInput);\n\n            it('has the correct grand total value', () => expect(pd.getAggregator([], []).value())\n                .toBe(2));\n        });\n\n        describe('with array-of-array input', function () {\n            const aoaInput = [['a', 'b'], [1, 2], [3, 4]];\n            const pd = new $.pivotUtilities.PivotData(aoaInput, sumOverSumOpts);\n\n            it('has the correct grand total value', () => expect(pd.getAggregator([], []).value())\n                .toBe((1 + 3) / (2 + 4)));\n        });\n\n        describe('with array-of-object input', function () {\n            const aosInput = [{ a: 1, b: 2 }, { a: 3, b: 4 }];\n            const pd = new $.pivotUtilities.PivotData(aosInput, sumOverSumOpts);\n\n            it('has the correct grand total value', () => expect(pd.getAggregator([], []).value())\n                .toBe((1 + 3) / (2 + 4)));\n        });\n\n        describe('with ragged array-of-object input', function () {\n            const raggedAosInput = [{ a: 1 }, { b: 4 }, { a: 3, b: 2 }];\n            const pd = new $.pivotUtilities.PivotData(raggedAosInput, sumOverSumOpts);\n\n            it('has the correct grand total value', () => expect(pd.getAggregator([], []).value())\n                .toBe((1 + 3) / (2 + 4)));\n        });\n\n        describe('with function input', function () {\n            const functionInput = function (record) {\n                record({ a: 1, b: 2 });\n                return record({ a: 3, b: 4 });\n            };\n            const pd = new $.pivotUtilities.PivotData(functionInput, sumOverSumOpts);\n\n            it('has the correct grand total value', () => expect(pd.getAggregator([], []).value())\n                .toBe((1 + 3) / (2 + 4)));\n        });\n\n        describe('with jQuery table element input', function () {\n            const tableInput = $(`\\\n<table>\n    <thead>\n        <tr> <th>a</th><th>b</th> </tr>\n    </thead>\n    <tbody>\n        <tr> <td>1</td> <td>2</td> </tr>\n        <tr> <td>3</td> <td>4</td> </tr>\n    </tbody>\n</table>\\\n`,\n            );\n            const pd = new $.pivotUtilities.PivotData(tableInput, sumOverSumOpts);\n\n            it('has the correct grand total value', () => expect(pd.getAggregator([], []).value())\n                .toBe((1 + 3) / (2 + 4)));\n        });\n\n\n        describe('with rows/cols', function () {\n            const pd = new $.pivotUtilities.PivotData(fixtureData, {\n                rows: ['name', 'colour'],\n                cols: ['trials', 'successes'],\n            });\n\n            it('has correctly-ordered row keys', () => expect(pd.getRowKeys())\n                .toEqual([['Carol', 'yellow'], ['Jane', 'red'], ['John', 'blue'], ['Nick', 'blue']]));\n\n            it('has correctly-ordered col keys', () => expect(pd.getColKeys())\n                .toEqual([[95, 25], [102, 14], [103, 12], [112, 30]]));\n\n            it('can be iterated over', function () {\n                let numNotNull = 0;\n                let numNull = 0;\n                for (const r of Array.from(pd.getRowKeys())) {\n                    for (const c of Array.from(pd.getColKeys())) {\n                        if (pd.getAggregator(r, c).value() != null) {\n                            numNotNull++;\n                        } else {\n                            numNull++;\n                        }\n                    }\n                }\n                expect(numNotNull)\n                    .toBe(4);\n                return expect(numNull)\n                    .toBe(12);\n            });\n\n            it('returns matching records', function () {\n                const records = [];\n                pd.forEachMatchingRecord({ gender: 'male' }, x => records.push(x.name));\n                return expect(records)\n                    .toEqual(['Nick', 'John']);\n            });\n\n            it('has a correct spot-checked aggregator', function () {\n                const agg = pd.getAggregator(['Carol', 'yellow'], [102, 14]);\n                const val = agg.value();\n                expect(val).toBe(1);\n                return expect(agg.format(val)).toBe('1');\n            });\n\n            it('has a correct grand total aggregator', function () {\n                const agg = pd.getAggregator([], []);\n                const val = agg.value();\n                expect(val).toBe(4);\n                return expect(agg.format(val)).toBe('4');\n            });\n        });\n    });\n\n    describe('.aggregatorTemplates', function () {\n\n        const getVal = function (aggregator) {\n            const pd = new $.pivotUtilities.PivotData(fixtureData, { aggregator });\n            return pd.getAggregator([], []).value();\n        };\n        const tpl = $.pivotUtilities.aggregatorTemplates;\n\n        describe('.count', () => it('works', () => expect(getVal(tpl.count()()))\n            .toBe(4)));\n\n        describe('.countUnique', () => it('works', () => expect(getVal(tpl.countUnique()(['gender'])))\n            .toBe(2)));\n\n        describe('.listUnique', () => it('works', () => expect(getVal(tpl.listUnique()(['gender'])))\n            .toBe('female,male')));\n\n        describe('.average', () => it('works', () => expect(getVal(tpl.average()(['trials'])))\n            .toBe(103)));\n\n        describe('.sum', () => it('works', () => expect(getVal(tpl.sum()(['trials'])))\n            .toBe(412)));\n\n        describe('.min', () => it('works', () => expect(getVal(tpl.min()(['trials'])))\n            .toBe(95)));\n\n        describe('.max', () => it('works', () => expect(getVal(tpl.max()(['trials'])))\n            .toBe(112)));\n\n        describe('.first', () => it('works', () => expect(getVal(tpl.first()(['name'])))\n            .toBe('Carol')));\n\n        describe('.last', () => it('works', () => expect(getVal(tpl.last()(['name'])))\n            .toBe('Nick')));\n\n        describe('.average', () => it('works', () => expect(getVal(tpl.average()(['trials'])))\n            .toBe(103)));\n\n        describe('.median', () => it('works', () => expect(getVal(tpl.median()(['trials'])))\n            .toBe(102.5)));\n\n        describe('.quantile', () => it('works', function () {\n            expect(getVal(tpl.quantile(0)(['trials'])))\n                .toBe(95);\n            expect(getVal(tpl.quantile(0.1)(['trials'])))\n                .toBe(98.5);\n            expect(getVal(tpl.quantile(0.25)(['trials'])))\n                .toBe(98.5);\n            expect(getVal(tpl.quantile(1 / 3)(['trials'])))\n                .toBe(102);\n            return expect(getVal(tpl.quantile(1)(['trials'])))\n                .toBe(112);\n        }));\n\n        describe('.var', () => it('works', () => expect(getVal(tpl.var()(['trials'])))\n            .toBe(48.666666666666686)));\n\n        describe('.stdev', () => it('works', () => expect(getVal(tpl.stdev()(['trials'])))\n            .toBe(6.976149845485451)));\n\n        describe('.sumOverSum', () => it('works', () => expect(getVal(tpl.sumOverSum()(['successes', 'trials'])))\n            .toBe((12 + 25 + 30 + 14) / (95 + 102 + 103 + 112))));\n    });\n\n    describe('.naturalSort()', function () {\n        const {\n            naturalSort,\n        } = $.pivotUtilities;\n\n        const sortedArr = [\n            null, NaN,\n            -Infinity, '-Infinity', -3, '-3', -2, '-2', -1, '-1',\n            0, '2e-1', 1, '01', '1', 2, '002', '002e0', '02', '2', '2e-0',\n            3, 10, '10', '11', '12', '1e2', '112', Infinity, 'Infinity',\n            '1a', '2a', '12a', '20a',\n            'A', 'A', 'NaN', 'a', 'a',\n            'a01', 'a012', 'a02', 'a1', 'a2', 'a12', 'a12', 'a21', 'a21',\n            'b', 'c', 'd', 'null',\n        ];\n\n        it('sorts naturally (null, NaN, numbers & numbery strings, Alphanum for text strings)', () => expect(sortedArr.slice().sort(naturalSort))\n            .toEqual(sortedArr));\n    });\n\n    describe('.sortAs()', function () {\n        const {\n            sortAs,\n        } = $.pivotUtilities;\n\n        it('sorts with unknown values sorted at the end', () => expect([5, 2, 3, 4, 1].sort(sortAs([4, 3, 2])))\n            .toEqual([4, 3, 2, 1, 5]));\n\n        it('sorts lowercase after uppercase', () => expect(['Ab', 'aA', 'aa', 'ab'].sort(sortAs(['Ab', 'Aa'])))\n            .toEqual(['Ab', 'ab', 'aa', 'aA']));\n    });\n\n    describe('.numberFormat()', function () {\n        const {\n            numberFormat,\n        } = $.pivotUtilities;\n\n        it('formats numbers', function () {\n            const nf = numberFormat();\n            return expect(nf(1234567.89123456))\n                .toEqual('1,234,567.89');\n        });\n\n        it('formats booleans', function () {\n            const nf = numberFormat();\n            return expect(nf(true))\n                .toEqual('1.00');\n        });\n\n        it('formats numbers in strings', function () {\n            const nf = numberFormat();\n            return expect(nf('1234567.89123456'))\n                .toEqual('1,234,567.89');\n        });\n\n        it('doesn\\'t formats strings', function () {\n            const nf = numberFormat();\n            return expect(nf('hi there'))\n                .toEqual('');\n        });\n\n        it('doesn\\'t formats objects', function () {\n            const nf = numberFormat();\n            return expect(nf({ a: 1 }))\n                .toEqual('');\n        });\n\n        it('formats percentages', function () {\n            const nf = numberFormat({ scaler: 100, suffix: '%' });\n            return expect(nf(0.12345))\n                .toEqual('12.35%');\n        });\n\n        it('adds separators', function () {\n            const nf = numberFormat({ thousandsSep: 'a', decimalSep: 'b' });\n            return expect(nf(1234567.89123456))\n                .toEqual('1a234a567b89');\n        });\n\n        it('adds prefixes and suffixes', function () {\n            const nf = numberFormat({ prefix: 'a', suffix: 'b' });\n            return expect(nf(1234567.89123456))\n                .toEqual('a1,234,567.89b');\n        });\n\n        it('scales and rounds', function () {\n            const nf = numberFormat({ digitsAfterDecimal: 3, scaler: 1000 });\n            return expect(nf(1234567.89123456))\n                .toEqual('1,234,567,891.235');\n        });\n\n\n        describe('.date', function () {\n            it('from date', function () {\n                const nf = numberFormat({});\n                return expect(nf(new Date('2024-01-01'), $.pivotUtilities.fieldsType.date))\n                    .toEqual('01/01/2024');\n            });\n\n            it('from ISO string', function () {\n                const nf = numberFormat({});\n                return expect(nf((new Date('2024-01-01')).toISOString(), $.pivotUtilities.fieldsType.date))\n                    .toEqual('01/01/2024');\n            });\n\n            it('to integer', function () {\n                const nf = numberFormat({});\n                return expect(nf(10, $.pivotUtilities.fieldsType.integer))\n                    .toEqual(10);\n            });\n\n            it('to integer', function () {\n                const nf = numberFormat({});\n                return expect(nf(10, (val) => `hello_${val}`))\n                    .toEqual('hello_10');\n            });\n        });\n\n    });\n\n    describe('.derivers', function () {\n        describe('.dateFormat()', function () {\n            const df = $.pivotUtilities.derivers.dateFormat('x', 'abc % %% %%% %a %y %m %n %d %w %x %H %M %S', true);\n\n            it('formats date objects', () => expect(df({ x: new Date('2015-01-02T23:43:11Z') }))\n                .toBe('abc % %% %%% %a 2015 01 Jan 02 Fri 5 23 43 11'));\n\n            it('formats input parsed by Date.parse()', function () {\n                expect(df({ x: '2015-01-02T23:43:11Z' }))\n                    .toBe('abc % %% %%% %a 2015 01 Jan 02 Fri 5 23 43 11');\n\n                return expect(df({ x: 'bla' }))\n                    .toBe('');\n            });\n        });\n\n        describe('.bin()', function () {\n            const binner = $.pivotUtilities.derivers.bin('x', 10);\n\n            it('bins numbers', function () {\n                expect(binner({ x: 11 }))\n                    .toBe(10);\n\n                expect(binner({ x: 9 }))\n                    .toBe(0);\n\n                return expect(binner({ x: 111 }))\n                    .toBe(110);\n            });\n\n            it('bins booleans', () => expect(binner({ x: true }))\n                .toBe(0));\n\n            it('bins negative numbers', () => expect(binner({ x: -12 }))\n                .toBe(-10));\n\n            it('doesn\\'t bin strings', () => expect(binner({ x: 'a' }))\n                .toBeNaN());\n\n            it('doesn\\'t bin objects', () => expect(binner({ x: { a: 1 } }))\n                .toBeNaN());\n        });\n    });\n\n    describe('.cellRenderers', function () {\n        it('cellRenderers string', () => expect($.pivotUtilities.cellRenderers.text.call({}, 'x').data)\n            .toBe('x'));\n\n        it('cellRenderers string', () => expect($.pivotUtilities.cellRenderers.text.call({fieldsType: {fname: $.pivotUtilities.fieldsType.date}}, new Date('2024-01-01'), 'fname').data)\n            .toBe('01/01/2024'));\n\n    });\n\n});\n"]}