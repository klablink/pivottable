"use strict";!function(tt){function R(t,e,r,a){let n;var l,o=tt(t).closest("table"),s=e?"rowSpan":"colSpan",i=e?1:Math.max(1,this.aggregator.length),u=([t._span,t[s]]=[t[s],null!=t._span?t._span:i],t[s]-t._span),d=m(r,a);for(l in d){var c=d[l];if(1===(n=C(o,e,c)[0])[s]){n._span+=u;break}n[s]+=u}return I(t,e,r,a,n)}let F,i="en";function l(e){let r="";if(e)try{var t={year:"numeric",month:"2-digit",day:"2-digit"};r=new Date(e).toLocaleDateString(i,t)}catch(t){r=e}return r}function t(r){return r=tt.extend({},{digitsAfterDecimal:2,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:""},r),function(t,e){return void 0===t?"":e===tt.pivotUtilities.fieldsType.integer?t:e===tt.pivotUtilities.fieldsType.date?l(t):tt.isFunction(e)?e(t):isNaN(t)||!isFinite(t)?"":(e=function(t,e,r){t=(t+="").split(".");let a=t[0];for(var r=1<t.length?r+t[1]:"",n=/(\d+)(\d{3})/;n.test(a);)a=a.replace(n,"$1"+e+"$2");return a+r}((r.scaler*t).toFixed(r.digitsAfterDecimal),r.thousandsSep,r.decimalSep),""+r.prefix+e+r.suffix)}}const E={text:function(t,e,r,a){var n=this["fieldsType"];return void 0===t&&(t=""),e&&n[e]===tt.pivotUtilities.fieldsType.date?document.createTextNode(l(t)):document.createTextNode(t)},byType:function(r,a){return function(t,e){return(r[e]||a||E.text).apply(this,arguments)}}},e=t(),r=t({digitsAfterDecimal:0}),a=t({digitsAfterDecimal:1,scaler:100,suffix:"%"}),u={count(a){return null==a&&(a=r),()=>function(t,e,r){return{count:0,push(){return this.count++},value(){return this.count},format:a}}},uniques(n,l){return null==l&&(l=r),function(...t){const[a]=t[0];return function(t,e,r){return{attr:a,uniq:[],push(t){if(!this.uniq.includes(t[a]))return this.uniq.push(t[a])},value(){return n(this.uniq)},format:l,numInputs:null!=a?0:1}}}},sum(n){return null==n&&(n=e),function(...t){const[a]=t[0];return function(t,e,r){return{attr:a,sum:0,push(t){if(!isNaN(parseFloat(t[a])))return this.sum+=parseFloat(t[a])},value(){return this.sum},format:n,numInputs:null!=a?0:1}}}},extremes(l,o){return null==o&&(o=e),function(...t){const[a]=t[0],n=t[1]||{};return function(t,e,r){return{attr:a,val:null,sorter:nt(null!=t?t.sorters:void 0,a),push(t){let e=t[a],r=this.val;n.rendererOptions?.fieldsType[a]===tt.pivotUtilities.fieldsType.date?(e=new Date(e),r=r?new Date(r):e):["min","max"].includes(l)&&(e=parseFloat(e)),["min","max"].includes(l)&&!isNaN(e)&&(this.val=Math[l](e,null!=r?r:e)),"first"===l&&this.sorter(e,null!=r?r:e)<=0&&(this.val=e),"last"===l&&0<=this.sorter(e,null!=r?r:e)&&(this.val=e),n.rendererOptions?.fieldsType[a]===tt.pivotUtilities.fieldsType.date&&(this.val=new Date(this.val).toISOString())},value(){return this.val},format(t,e){return isNaN(t)?t:o(t,e)},numInputs:null!=a?0:1}}}},quantile(n,l){return null==l&&(l=e),function(...t){const[a]=t[0];return function(t,e,r){return{attr:a,vals:[],push(t){t=parseFloat(t[a]);if(!isNaN(t))return this.vals.push(t)},value(){if(0===this.vals.length)return null;this.vals.sort((t,e)=>t-e);var t=(this.vals.length-1)*n;return(this.vals[Math.floor(t)]+this.vals[Math.ceil(t)])/2},format:l,numInputs:null!=a?0:1}}}},runningStat(n,l,o){return null==n&&(n="mean"),null==l&&(l=1),null==o&&(o=e),function(...t){const[a]=t[0];return function(t,e,r){return{attr:a,n:0,m:0,s:0,push(t){var e,t=parseFloat(t[a]);if(!isNaN(t))return this.n+=1,1===this.n?this.m=t:(e=this.m+(t-this.m)/this.n,this.s=this.s+(t-this.m)*(t-e),this.m=e)},value(){if("mean"===n)return 0===this.n?NaN:this.m;if(this.n<=l)return 0;switch(n){case"var":return this.s/(this.n-l);case"stdev":return Math.sqrt(this.s/(this.n-l))}},format:o,numInputs:null!=a?0:1}}}},sumOverSum(l){return null==l&&(l=e),function(...t){const[a,n]=t[0];return function(t,e,r){return{sumNum:0,sumDenom:0,push(t){if(isNaN(parseFloat(t[a]))||(this.sumNum+=parseFloat(t[a])),!isNaN(parseFloat(t[n])))return this.sumDenom+=parseFloat(t[n])},value(){return this.sumNum/this.sumDenom},format:l,numInputs:null!=a&&null!=n?0:2}}}},sumOverSumBound80(l,o){return null==l&&(l=!0),null==o&&(o=e),function(...t){const[a,n]=t[0];return function(t,e,r){return{sumNum:0,sumDenom:0,push(t){if(isNaN(parseFloat(t[a]))||(this.sumNum+=parseFloat(t[a])),!isNaN(parseFloat(t[n])))return this.sumDenom+=parseFloat(t[n])},value(){var t=l?1:-1;return(.821187207574908/this.sumDenom+this.sumNum/this.sumDenom+1.2815515655446004*t*Math.sqrt(.410593603787454/(this.sumDenom*this.sumDenom)+this.sumNum*(1-this.sumNum/this.sumDenom)/(this.sumDenom*this.sumDenom)))/(1+1.642374415149816/this.sumDenom)},format:o,numInputs:null!=a&&null!=n?0:2}}}},fractionOf(n,l,o){return null==l&&(l="total"),null==o&&(o=a),(...a)=>function(e,t,r){return{selector:{total:[[],[]],row:[t,[]],col:[[],r]}[l],inner:n(...a||[])(e,t,r),push(t){return this.inner.push(t)},format:o,value(t){t=e.getAggregator(...this.selector,t);return this.inner.value()/t.inner.value()},numInputs:n(...a||[])().numInputs}}}};function w(t,e,r){return{Count:u.count(e),"Count Unique Values":u.countUnique(e),"List Unique Values":u.listUnique(", "),Sum:u.sum(t),"Integer Sum":u.sum(e),Average:u.average(t),Median:u.median(t),"Sample Variance":u.var(1,t),"Sample Standard Deviation":u.stdev(1,t),Minimum:u.min(t),Maximum:u.max(t),First:u.first(t),Last:u.last(t),"Sum over Sum":u.sumOverSum(t),"80% Upper Bound":u.sumOverSumBound80(!0,t),"80% Lower Bound":u.sumOverSumBound80(!1,t),"Sum as Fraction of Total":u.fractionOf(u.sum(),"total",r),"Sum as Fraction of Rows":u.fractionOf(u.sum(),"row",r),"Sum as Fraction of Columns":u.fractionOf(u.sum(),"col",r),"Count as Fraction of Total":u.fractionOf(u.count(),"total",r),"Count as Fraction of Rows":u.fractionOf(u.count(),"row",r),"Count as Fraction of Columns":u.fractionOf(u.count(),"col",r)}}u.countUnique=t=>u.uniques(t=>t.length,t),u.listUnique=e=>u.uniques(t=>t.sort(at).join(e),t=>t),u.max=t=>u.extremes("max",t),u.min=t=>u.extremes("min",t),u.first=t=>u.extremes("first",t),u.last=t=>u.extremes("last",t),u.median=t=>u.quantile(.5,t),u.average=t=>u.runningStat("mean",1,t),u.var=(t,e)=>u.runningStat("var",t,e),u.stdev=(t,e)=>u.runningStat("stdev",t,e);const A=w(e,r,a),et={Table(t,e){return g(t,e)},"Table Barchart"(t,e){return tt(g(t,e)).barchart()},Heatmap(t,e){return tt(g(t,e)).heatmap("heatmap",e)},"Row Heatmap"(t,e){return tt(g(t,e)).heatmap("rowheatmap",e)},"Col Heatmap"(t,e){return tt(g(t,e)).heatmap("colheatmap",e)}},rt={en:{formatters:{format:e,formatInt:r,formatPct:a},renderers:et,localeStrings:{renderError:"An error occurred rendering the PivotTable results.",computeError:"An error occurred computing the PivotTable results.",uiRenderError:"An error occurred rendering the PivotTable UI.",selectAll:"Select All",selectNone:"Select None",tooMany:"(too many to list)",filterResults:"Filter values",apply:"Apply",cancel:"Cancel",totals:"Totals",vs:"vs",by:"by",rendererLabel:"Renderer",valuesLabel:"Values",fieldsLabel:"Fields",colsLabel:"Columns",rowsLabel:"Rows",groupsLabel:"Groups"}}};for(const o of Object.keys(A))rt.en.localeStrings[o]=o;const x=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],N=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],s=(t,e=2)=>("0"+t).substr(-e,e),d=/(\d+)|(\D+)/g,c=/\d/,p=/^0/,at=(t,e,r)=>{r=(r=null==r?!0:r)?1:-1;if(null!=e&&null==t)return-1*r;if(null!=t&&null==e)return r;if("number"==typeof t&&isNaN(t))return-1;if("number"==typeof e&&isNaN(e))return 1;var r=+t,a=+e;if(r<a)return-1;if(a<r)return 1;if("number"==typeof t&&"number"!=typeof e)return-1;if("number"==typeof e&&"number"!=typeof t)return 1;if("number"==typeof t&&"number"==typeof e)return 0;if(isNaN(a)&&!isNaN(r))return-1;if(isNaN(r)&&!isNaN(a))return 1;let n=String(t),l=String(e);if(n===l)return 0;if(!c.test(n)||!c.test(l))return n>l?1:-1;for(n=n.match(d),l=l.match(d);n.length&&l.length;){var o=n.shift(),s=l.shift();if(o!==s)return c.test(o)&&c.test(s)?o.replace(p,".0")-s.replace(p,".0"):s<o?1:-1}return n.length-l.length};function nt(t,e){if(null!=t)if(tt.isFunction(t)){var r=t(e);if(tt.isFunction(r))return r}else if(null!=t[e])return t[e];return at}const n=(t,e)=>t.filter(t=>t.length===e),h=r=>r.map((t,e)=>r.slice(0,e+1));class lt{constructor(t,e){this.arrSort=this.arrSort.bind(this),this.sortKeys=this.sortKeys.bind(this),this.getColKeys=this.getColKeys.bind(this),this.getRowKeys=this.getRowKeys.bind(this),this.getAggregator=this.getAggregator.bind(this),null==e&&(e={}),this.input=t,Array.isArray(e.aggregator)||(e.aggregator=null!=e.aggregator?e.aggregator:u.count()(),e.aggregator=[e.aggregator]),this.aggregator=null!=e.aggregator?e.aggregator:[u.count()()],this.aggregatorName=null!=e.aggregatorName?e.aggregatorName:"Count",this.colAttrs=null!=e.cols?e.cols:[],this.rowAttrs=null!=e.rows?e.rows:[],this.valAttrs=null!=e.vals?e.vals:[],this.sorters=null!=e.sorters?e.sorters:{},this.rowOrder=null!=e.rowOrder?e.rowOrder:"key_a_to_z",this.colOrder=null!=e.colOrder?e.colOrder:"key_a_to_z",this.derivedAttributes=null!=e.derivedAttributes?e.derivedAttributes:{},this.filter=null!=e.filter?e.filter:()=>!0,this.tree={},this.rowKeys=[],this.colKeys=[],this.rowTotals={},this.colTotals={},this.allTotal=this.aggregator.map(t=>t(this,[],[])),this.sorted=!1,this.aggregatorsLabel=null!=e.aggregatorsLabel?e.aggregatorsLabel:[],this.grouping=null!=e.grouping&&e.grouping,this.rowGroupBefore=null==(null!=e.grouping?e.grouping.rowGroupBefore:void 0)||(null!=e.grouping?e.grouping.rowGroupBefore:void 0),this.colGroupBefore=null!=(null!=e.grouping?e.grouping.colGroupBefore:void 0)&&(null!=e.grouping?e.grouping.colGroupBefore:void 0),lt.forEachRecord(this.input,this.derivedAttributes,t=>{if(this.filter(t))return this.processRecord((r=t,Object.entries(r).forEach(([t,e])=>{e instanceof Date&&(r[t]=e.toISOString())}),r));var r})}static forEachRecord(t,a,n){let r;if(r=tt.isEmptyObject(a)?n:function(t){for(var e in a){var r=a[e];t[e]=r(t)||t[e]}return n(t)},tt.isFunction(t))return t(r);if(tt.isArray(t)){if(tt.isArray(t[0])){var e,l=[];for(e of Object.keys(t||{})){var o=t[e];if(0<e){var s,i={};for(s of Object.keys(t[0]||{}))i[t[0][s]]=o[s];l.push(r(i))}}return l}var u,d=[];for(u of t)d.push(r(u));return d}if(t instanceof tt){const c=[];return tt("thead > tr > th",t).each(function(t){return c.push(tt(this).text())}),tt("tbody > tr",t).each(function(t){const e={};return tt("td",this).each(function(t){return e[c[t]]=tt(this).text()}),r(e)})}throw new Error("unknown input format")}forEachMatchingRecord(r,a){return lt.forEachRecord(this.input,this.derivedAttributes,t=>{if(this.filter(t)){for(var e in r)if(r[e]!==(null!=t[e]?t[e]:"null"))return;return a(t)}})}arrSort(t,a){const n=[];for(const e of t)n.push(nt(this.sorters,e));return function(t,e){for(var r of Object.keys(n||{})){r=(0,n[r])(t[r],e[r],a);if(0!==r)return r}return 0}}sortKeys(){if(!this.sorted){this.sorted=!0;const r=(t,e)=>this.getAggregator(t,e).value();switch(this.rowOrder){case"value_a_to_z":this.rowKeys.sort((t,e)=>at(r(t,[]),r(e,[])));break;case"value_z_to_a":this.rowKeys.sort((t,e)=>-at(r(t,[]),r(e,[])));break;default:this.rowKeys.sort(this.arrSort(this.rowAttrs,this.rowGroupBefore))}switch(this.colOrder){case"value_a_to_z":return this.colKeys.sort((t,e)=>at(r([],t),r([],e)));case"value_z_to_a":return this.colKeys.sort((t,e)=>-at(r([],t),r([],e)));default:return this.colKeys.sort(this.arrSort(this.colAttrs,this.colGroupBefore))}}}getColKeys(t){return null==t&&(t=!1),this.sortKeys(),t?this.colKeys:n(this.colKeys,this.colAttrs.length)}getRowKeys(t){return null==t&&(t=!1),this.sortKeys(),t?this.rowKeys:n(this.rowKeys,this.rowAttrs.length)}processRecord(r){let t,e=[],a=[];for(t of this.colAttrs)e.push(null!=r[t]?r[t]:"null");for(t of this.rowAttrs)a.push(null!=r[t]?r[t]:"null");e=this.grouping&&e.length?h(e):[e],a=this.grouping&&a.length?h(a):[a],this.aggregator.forEach((t,e)=>this.allTotal[e].push(r));var n,l=[];for(n in a){const d=a[n];var o,s=d.join(String.fromCharCode(0)),i=[];for(o in e){const c=e[o];var u=c.join(String.fromCharCode(0));0!==d.length&&(this.rowTotals[s]||(this.rowKeys.push(d),this.rowTotals[s]=this.aggregator.map(t=>t(this,d,[]))),this.rowTotals[s].forEach((t,e)=>{if(!this.grouping||1===c.length)return t.push(r)})),0!==c.length&&(this.colTotals[u]||(this.colKeys.push(c),this.colTotals[u]=this.aggregator.map(t=>t(this,[],c))),this.colTotals[u].forEach((t,e)=>{if(!this.grouping||1===d.length)return t.push(r)})),0!==c.length&&0!==d.length?(this.tree[s]||(this.tree[s]={}),this.tree[s][u]||(this.tree[s][u]=this.aggregator.map(t=>t(this,d,c))),i.push(this.tree[s][u].forEach((t,e)=>t.push(r)))):i.push(void 0)}l.push(i)}return l}getAggregator(t,e,r){let a;null==r&&(r=0);var n=t.join(String.fromCharCode(0)),l=e.join(String.fromCharCode(0));return null!=(a=0===t.length&&0===e.length?this.allTotal[r]:0===t.length?this.colTotals[l]&&this.colTotals[l][r]:0===e.length?this.rowTotals[n]&&this.rowTotals[n][r]:this.tree[n][l]&&this.tree[n][l][r])?a:{value(){return null},format(){return""}}}}const ot=t=>t.map((t,e)=>t.displayName=String.fromCharCode(97+e).toUpperCase());function g(o,s){let t,e,r,a,n,l,i,u,d,c,p,h,g;var f={table:{clickCallback:null,rowTotals:!0,colTotals:!0},localeStrings:{totals:"Totals"},typeCellRenderer:E.text,headCellRenderer:E.text,dataCellRenderer:E.text,fieldsType:{}};s=tt.extend(!0,{},f,s);const v=o["colAttrs"],m=o["rowAttrs"];function b(e,r,a){let n;if(0!==r){var l,o;let t=!0;for(l=(n=0)<=(o=a);l?n<=o:n>=o;l?n++:n--)e[r-1][n]!==e[r][n]&&(t=!1);if(t)return-1}let s=0;for(;r+s<e.length;){var i,u;let t=!1;for(i=(n=0)<=(u=a);i?n<=u:n>=u;i?n++:n--)e[r][n]!==e[r+s][n]&&(t=!0);if(t)break;s++}return s}var C=o.getRowKeys(!0),y=o.getColKeys(!0),w=(s.table.clickCallback&&(a=function(e,t,r){let a,n;const l={};for(n of Object.keys(v||{}))a=v[n],null!=r[n]&&(l[a]=r[n]);for(n of Object.keys(m||{}))a=m[n],null!=t[n]&&(l[a]=t[n]);return t=>s.table.clickCallback(t,e,l,o)}),(null==s.table.compactLayout||s.table.compactLayout)&&o.grouping),f=w?I:o.rowGroupBefore?R:M,A=U(C,!0,f.bind(o)),T=U(y,!1,R.bind(o)),f=document.createElement("table"),x=(f.className="pvtTable",document.createElement("thead"));for(i of Object.keys(v||{})){var N=v[i];p=document.createElement("tr"),0===parseInt(i)&&0!==m.length&&((d=document.createElement("th")).setAttribute("colspan",m.length),d.setAttribute("rowspan",v.length),p.appendChild(d)),(d=document.createElement("th")).className="pvtAxisLabel",d.appendChild(s.typeCellRenderer.call(s,N)),o.grouping&&i<v.length-1&&(d.onclick=F(o,+i,!1),d.className+=" open level"+i),p.appendChild(d);for(n of Object.keys(y||{}))r=y[n],-1!==(g=b(y,parseInt(n),parseInt(i)))&&((d=document.createElement("th")).className="pvtColLabel",d.className+=" col"+(o.colGroupBefore?+n:+n+g-1),d.appendChild(s.headCellRenderer.call(s,r[i],N)),d.setAttribute("colspan",g*Math.max(1,o.aggregator.length)),parseInt(i)===v.length-1&&0!==m.length&&d.setAttribute("rowspan",2),o.grouping&&i<v.length-1&&r[i]&&(d.className+=" pvtSubtotal open",d.setAttribute("colspan",g*Math.max(1,o.aggregator.length)),d.onclick=T),p.appendChild(d));0===parseInt(i)&&s.table.rowTotals&&((d=document.createElement("th")).className="pvtTotalLabel pvtRowTotalLabel",d.innerHTML=s.localeStrings.totals,d.setAttribute("colspan",Math.max(1,o.aggregator.length)),d.setAttribute("rowspan",v.length+(0===m.length?0:1)),p.appendChild(d)),x.appendChild(p)}if(0!==m.length){p=document.createElement("tr");for(n of Object.keys(m||{})){var S=m[n];(d=document.createElement("th")).className="pvtAxisLabel",d.appendChild(s.typeCellRenderer.call(s,S)),o.grouping&&n<m.length-1&&(d.className+=" open level"+n,d.onclick=F(o,+n,!0)),p.appendChild(d)}d=document.createElement("th"),0===v.length&&(d.className="pvtTotalLabel pvtRowTotalLabel",d.innerHTML=s.localeStrings.totals,d.setAttribute("colspan",o.aggregator.length)),p.appendChild(d),x.appendChild(p)}f.appendChild(x);var k=document.createElement("tbody");if(o.aggregatorsLabel&&1<o.aggregatorsLabel.length){let t;p=document.createElement("tr"),d=document.createElement("th");var O=m.length+(0===v.length?0:1);d.setAttribute("colspan",O),p.appendChild(d);for(i of Object.keys(y||{})){r=y[i];for(t of o.aggregatorsLabel)(d=document.createElement("th")).className="pvtAggregatorLabel col"+i,d.textContent=t,p.appendChild(d)}for(t of o.aggregatorsLabel)(d=document.createElement("th")).className="pvtAggregatorLabel",d.textContent=t,p.appendChild(d);k.appendChild(p)}for(n of Object.keys(C||{})){var _=C[n],D=(p=document.createElement("tr"),m.length-_.length);p.className=D?"pvtSubtotal level"+_.length:"pvtData";for(i of Object.keys(_||{})){var L=_[i];w&&i<_.length-1||-1!==(g=w?1:b(C,parseInt(n),parseInt(i)))&&((d=document.createElement("th")).className="pvtRowLabel",d.className+=" row"+(o.rowGroupBefore?+n:+n+g-1),d.appendChild(s.headCellRenderer.call(s,L,m[i])),d.setAttribute("rowspan",g),w&&(d.colSpan=m.length,d.style.paddingLeft=5+20*parseInt(i)+"px"),o.grouping&&i<m.length-1&&(d.className+=" open",d.onclick=A),p.appendChild(d))}!w&&D&&((d=document.createElement("th")).colSpan=D,d.textContent=`Total (${_[i]})`,p.appendChild(d)),v.length&&d.colSpan++;for(i of Object.keys(y||{}))for(r=y[i],l=0;l<o.aggregator.length;l++)t=o.aggregator[l],e=o.getAggregator(_,r,l),h=e.value(l),u=document.createElement("td"),D||(u.className="pvtVal "),u.className+=`row${n} col`+i,v.length-r.length&&(u.className=`pvtSubtotal level${r.length} row${n} col`+i),u.appendChild(s.dataCellRenderer.call(s,e.format(h,s.fieldsType[e?.attr]),e?.attr,_,r)),u.setAttribute("data-value",h),null!=a&&(u.onclick=a(h,_,r)),p.appendChild(u);if(s.table.rowTotals||0===v.length)for(l=0;l<o.aggregator.length;l++)t=o.aggregator[l],c=o.getAggregator(_,[],l),h=c.value(l),(u=document.createElement("td")).className="pvtTotal rowTotal",u.append(s.dataCellRenderer.call(s,c.format(h,s.fieldsType[c?.attr]),c?.attr,_,[])),u.setAttribute("data-value",h),null!=a&&(u.onclick=a(h,_,[])),u.setAttribute("data-for","row"+n),p.appendChild(u);k.appendChild(p)}if(s.table.colTotals||0===m.length){p=document.createElement("tr"),!s.table.colTotals&&0!==m.length||((d=document.createElement("th")).className="pvtTotalLabel pvtColTotalLabel",d.innerHTML=s.localeStrings.totals,d.setAttribute("colspan",m.length+(0===v.length?0:1)),p.appendChild(d));for(i of Object.keys(y||{}))for(r=y[i],l=0;l<o.aggregator.length;l++)t=o.aggregator[l],c=o.getAggregator([],r,l),h=c.value(l),(u=document.createElement("td")).className="pvtTotal colTotal col"+i,r.length!==v.length&&(u.className+=" pvtSubtotal level"+r.length),u.append(s.dataCellRenderer.call(s,c.format(h,s.fieldsType[c?.attr]),c?.attr,[],r)),u.setAttribute("data-value",h),null!=a&&(u.onclick=a(h,[],r)),u.setAttribute("data-for","col"+i),p.appendChild(u);if(s.table.rowTotals||0===v.length)for(l=0;l<o.aggregator.length;l++)t=o.aggregator[l],c=o.getAggregator([],[],l),h=c.value(l),(u=document.createElement("td")).className="pvtGrandTotal",u.append(s.dataCellRenderer.call(s,c.format(h,s.fieldsType[c?.attr]),c?.attr,[],[])),u.setAttribute("data-value",h),null!=a&&(u.onclick=a(h,[],[])),p.appendChild(u);k.appendChild(p)}return f.appendChild(k),f.setAttribute("data-numrows",C.length),f.setAttribute("data-numcols",y.length),f}tt.pivotUtilities={aggregatorTemplates:u,aggregators:A,renderers:et,cellRenderers:E,derivers:{bin(e,r){return t=>t[e]-t[e]%r},dateFormat(e,a,t,n,l){null==t&&(t=!1),null==n&&(n=x),null==l&&(l=N);const o=t?"UTC":"";return function(t){const r=new Date(Date.parse(t[e]));return isNaN(r)?"":a.replace(/%(.)/g,function(t,e){switch(e){case"y":return r[`get${o}FullYear`]();case"m":return s(r[`get${o}Month`]()+1);case"n":return n[r[`get${o}Month`]()];case"d":return s(r[`get${o}Date`]());case"w":return l[r[`get${o}Day`]()];case"x":return r[`get${o}Day`]();case"H":return s(r[`get${o}Hours`]());case"M":return s(r[`get${o}Minutes`]());case"S":return s(r[`get${o}Seconds`]());default:return"%"+e}})}}},locales:rt,fieldsType:{string:"String",number:"Number",date:"Date",time:"Time",datetime:"Datetime",boolean:"Boolean",integer:"Integer"},zeroPad:s,naturalSort:at,numberFormat:t,sortAs:function(t){const r={},a={};for(var e in t){var n=t[e];r[n]=e,"string"==typeof n&&(a[n.toLowerCase()]=e)}return function(t,e){return null!=r[t]&&null!=r[e]?r[t]-r[e]:null!=r[t]?-1:null!=r[e]?1:null!=a[t]&&null!=a[e]?a[t]-a[e]:null!=a[t]?-1:null!=a[e]?1:at(t,e)}},PivotData:lt},tt.fn.pivot=function(t,e,r){let a;null==r&&(r="en"),null==rt[r]&&(r="en"),i=r,e=e||{};var n={cols:[],rows:[],vals:[],rowOrder:"key_a_to_z",colOrder:"key_a_to_z",dataClass:lt,filter(){return!0},aggregator:u.count()(),aggregatorName:"Count",sorters:{},derivedAttributes:{},renderer:g},r=tt.extend(!0,{},rt.en.localeStrings,rt[r].localeStrings),r=tt.extend(!0,{},{rendererOptions:{localeStrings:r},localeStrings:r},tt.extend({},n,e));let l;e.pivotData=null;try{var o=new r.dataClass(t,r);try{l=r.renderer(o,r.rendererOptions),e.pivotData=o}catch(t){a=t,"undefined"!=typeof console&&null!==console&&console.error(a.stack),l=tt("<span>").html(r.localeStrings.renderError)}}catch(t){a=t,"undefined"!=typeof console&&null!==console&&console.error(a.stack),l=tt("<span>").html(r.localeStrings.computeError)}for(var s=this[0];s.hasChildNodes();)s.removeChild(s.lastChild);return this.append(l)},tt.fn.pivotUI=function(j,t,e,T){let x,r,n;null==e&&(e=!1),null==T&&(T="fr"),null==rt[T]&&(T="en");var C={derivedAttributes:{},aggregators:A,renderers:et,hiddenAttributes:[],hiddenFromAggregators:[],hiddenFromDragDrop:[],menuLimit:500,cols:[],rows:[],vals:[],rowOrder:"key_a_to_z",colOrder:"key_a_to_z",dataClass:lt,exclusions:{},inclusions:{},unusedAttrsVertical:85,autoSortUnusedAttrs:!1,onRefresh:null,showUI:!0,filter(){return!0},sorters:{},multiple:!0,parametersActive:!1};let l=0,N=[];var o=tt.extend(!0,{},rt.en.localeStrings,rt[T].localeStrings),y={rendererOptions:{localeStrings:o},localeStrings:o},a=this.data("pivotUIOptions");x=null==a||e?tt.extend(!0,{},y,tt.extend({},C,t)):a,!t?.aggregators&&rt[T].formatters&&(x.aggregators=w(rt[T].formatters.format,rt[T].formatters.formatInt,rt[T].formatters.formatPct));try{let C,y,e,w;const S={},k=[];let a=0;lt.forEachRecord(j,x.derivedAttributes,function(t){let e;if(x.filter(t)){k.push(t);for(e of Object.keys(t||{}))null==S[e]&&(S[e]={},0<a)&&(S[e].null=a);for(e in S){var r=null!=t[e]?t[e]:"null";null==S[e][r]&&(S[e][r]=0),S[e][r]++}return a++}});var s=tt("<div>").addClass("pvtUi"),i=tt("<div>").addClass("pvtUiMenu");const O=tt("<div>").addClass("pvtUiParameters");var u=tt("<div>").addClass("pvtUiContainer");const _=tt("<div>").addClass("pvtUiVerticalButton").addClass("pvtUiButtonColumns").addClass("active").text(o.colsLabel).on("click",function(){return x.parametersActive=!x.parametersActive,x.parametersActive?(_.addClass("active"),O.show()):(_.removeClass("active"),O.hide())}).appendTo(i),D=tt("<div>").addClass("pvtUiVerticalButton").addClass("pvtUiButtonGroups").text(o.groupsLabel).on("click",function(){return x.grouping?(D.removeClass("active"),x.grouping=!1):(D.addClass("active"),x.grouping={colGroupBefore:!1}),U()}).appendTo(i);s.append(i).append(O).append(u),tt("<div>").addClass("pvtParameterLabel").appendTo(O).text(o.rendererLabel);var V=tt("<div>").addClass("pvtRendererType").addClass("pvtParameter").appendTo(O);const L=tt("<select>").addClass("pvtRenderer").appendTo(V).bind("change",()=>U());for(w of Object.keys(x.renderers||{})){var $=x.localeStrings[w]||w;tt("<option>").val(w).html($).appendTo(L)}var d=tt("<div>").addClass("pvtAxisContainer pvtUnused"),c=[];for(r in S)x.hiddenAttributes.includes(r)||c.push(r);const R=[];for(n of c)x.hiddenFromAggregators.includes(n)||R.push(n);var p=[];for(n of c)x.hiddenFromDragDrop.includes(n)||p.push(n);if(e="auto"===x.unusedAttrsVertical?120:parseInt(x.unusedAttrsVertical),!isNaN(e)){let t=0;for(r of p)t+=r.length;t,e}for(y of Object.keys(p||{})){C=p[y];var h=[];for(const X in S[C])h.push(X);let e=!1;const M=tt("<div>").addClass("pvtFilterBox").hide();if(M.append(tt("<h4>").append(tt("<span>").text(C),tt("<span>").addClass("count").text(`(${h.length})`))),h.length>x.menuLimit)M.append(tt("<p>").html(x.localeStrings.tooMany));else{if(5<h.length){var g=tt("<p>").appendTo(M);const Z=nt(x.sorters,C);var q=x.localeStrings.filterResults;tt("<input>",{type:"text"}).appendTo(g).attr({placeholder:q,class:"pvtSearch"}).bind("keyup",function(){const n=tt(this).val().toLowerCase().trim();var t=(r,a)=>function(t){var e=n.substring(r.length).trim();return 0===e.length||a.includes(Math.sign(Z(t.toLowerCase(),e)))};const e=0===n.indexOf(">=")?t(">=",[1,0]):0===n.indexOf("<=")?t("<=",[-1,0]):0===n.indexOf(">")?t(">",[1]):0===n.indexOf("<")?t("<",[-1]):0===n.indexOf("~")?function(t){return 0===n.substring(1).trim().length||t.toLowerCase().match(n.substring(1))}:t=>-1!==t.toLowerCase().indexOf(n);return M.find(".pvtCheckContainer p label span.value").each(function(){return e(tt(this).text())?tt(this).parent().parent().show():tt(this).parent().parent().hide()})}),g.append(tt("<br>")),tt("<button>",{type:"button"}).appendTo(g).html(x.localeStrings.selectAll).bind("click",function(){return M.find("input:visible:not(:checked)").prop("checked",!0).toggleClass("changed"),!1}),tt("<button>",{type:"button"}).appendTo(g).html(x.localeStrings.selectNone).bind("click",function(){return M.find("input:visible:checked").prop("checked",!1).toggleClass("changed"),!1})}var f,z=tt("<div>").addClass("pvtCheckContainer").appendTo(M);for(f of h.sort(nt(x.sorters,C))){var P=S[C][f],v=tt("<label>");let t=!1;x.inclusions[C]?t=!x.inclusions[C].includes(f):x.exclusions[C]&&(t=x.exclusions[C].includes(f)),e=e||t,tt("<input>").attr("type","checkbox").addClass("pvtFilter").attr("checked",!t).data("filter",[C,f]).appendTo(v).bind("change",function(){return tt(this).toggleClass("changed")}),v.append(tt("<span>").addClass("value").text(f)),v.append(tt("<span>").addClass("count").text("("+P+")")),z.append(tt("<p>").append(v))}}const B=function(){return M.find("[type='checkbox']").length>M.find("[type='checkbox']:checked").length?K.addClass("pvtFilteredAttribute"):K.removeClass("pvtFilteredAttribute"),M.find(".pvtSearch").val(""),M.find(".pvtCheckContainer p").show(),M.hide()};var m=tt("<p>").appendTo(M),G=(h.length<=x.menuLimit&&tt("<button>",{type:"button"}).text(x.localeStrings.apply).appendTo(m).bind("click",function(){return M.find(".changed").removeClass("changed").length&&U(),B()}),tt("<button>",{type:"button"}).text(x.localeStrings.cancel).appendTo(m).bind("click",function(){return M.find(".changed:checked").removeClass("changed").prop("checked",!1),M.find(".changed:not(:checked)").removeClass("changed").prop("checked",!0),B()}),tt("<span>").addClass("pvtTriangle").html(" &#x25BE;").bind("click",function(t){var{left:t,top:e}=tt(t.currentTarget).position();return M.css({left:t+10,top:e+10}).show()}));const K=tt("<li>").addClass("axis_"+y).append(tt("<span>").addClass("pvtAttr").text(C).data("attrName",C).append(G));e&&K.addClass("pvtFilteredAttribute"),d.append(K).append(M)}tt("<div>").addClass("pvtParameterLabel").appendTo(O).text(o.valuesLabel);var b=tt("<div>").addClass("pvtAggregatorChoose").addClass("pvtParameter").appendTo(O);const F=tt("<select>").addClass("pvtAggregator").appendTo(b).bind("change",()=>{if(!x.multiple)return this.find(".pvtVals .pvtAttrDropdown").each(function(){return this.remove()}),N=[{id:1,value:F.val()}],U()});for(w of Object.keys(x.aggregators||{}))F.append(tt("<option>").val(w).html(rt[T].localeStrings[w]||rt.en.localeStrings[w]||w));x.multiple&&tt("<a>",{role:"button"}).addClass("pvtAddAggregator").addClass("pvtToolButton").appendTo(b).html("+").bind("click",function(){return N.push({id:++l,value:F.val()}),ot(N),U()});const E={key_a_to_z:{rowSymbol:"&varr;",colSymbol:"&harr;",next:"value_a_to_z"},value_a_to_z:{rowSymbol:"&darr;",colSymbol:"&rarr;",next:"value_z_to_a"},value_z_to_a:{rowSymbol:"&uarr;",colSymbol:"&larr;",next:"key_a_to_z"}},W=tt("<a>",{role:"button"}).addClass("pvtRowOrder").addClass("pvtToolButton").appendTo(b).data("order",x.rowOrder).html(E[x.rowOrder].rowSymbol).bind("click",function(){return tt(this).data("order",E[tt(this).data("order")].next),tt(this).html(E[tt(this).data("order")].rowSymbol),U()}),Q=tt("<a>",{role:"button"}).addClass("pvtColOrder").addClass("pvtToolButton").appendTo(b).data("order",x.colOrder).html(E[x.colOrder].colSymbol).bind("click",function(){return tt(this).data("order",E[tt(this).data("order")].next),tt(this).html(E[tt(this).data("order")].colSymbol),U()});var H=tt("<div>").addClass("pvtVals").addClass("pvtParameter").appendTo(O);O.append(H),tt("<div>").addClass("pvtParameterLabel").appendTo(O).text(o.fieldsLabel),O.append(d),tt("<div>").addClass("pvtParameterLabel").appendTo(O).text(o.colsLabel),tt("<div>").addClass("pvtAxisContainer pvtCols").appendTo(O),tt("<div>").addClass("pvtParameterLabel").appendTo(O).text(o.rowsLabel),tt("<div>").addClass("pvtAxisContainer pvtRows").appendTo(O);const I=tt("<div>").addClass("pvtRendererArea").appendTo(u);this.html(s),x.parametersActive||(_.removeClass("active"),O.hide());let A=!0;const Y=()=>{let t;const e={derivedAttributes:x.derivedAttributes,localeStrings:x.localeStrings,rendererOptions:x.rendererOptions,sorters:x.sorters,cols:[],rows:[],dataClass:x.dataClass,grouping:x.grouping};this.find(".pvtRows li span.pvtAttr").each(function(){return e.rows.push(tt(this).data("attrName"))}),this.find(".pvtCols li span.pvtAttr").each(function(){return e.cols.push(tt(this).data("attrName"))});let a=0;const n=[];let r=0,l=r;for(;r<N.length;r++,l=r){let e;const b=N[l];"object"==typeof b&&(e=b.value);var o=b.id,s=b.vals,i=(a=x.aggregators[e]([])().numInputs||0,t=[],this.find(".pvtVals select.pvtAttrDropdown"+o).each(function(){if(0!==a&&(a--,""!==tt(this).val()))return t.push(tt(this).val())}),this.find(".pvtVals"));let r=this.find(".pvtVals .pvtAttrDropdownContainer"+o);var u=0<r.length;if(x.multiple){let t;u||(r=tt("<div>").addClass("pvtAttrDropdownContainer").addClass("pvtAttrDropdownContainer"+o).appendTo(i),t=rt[T].localeStrings[e]||rt.en.localeStrings[e]||e,tt("<label>").addClass("pvtAttrDropdown").addClass("pvtAttrDropdown"+o).appendTo(r).html("<b>"+b.displayName+"</b>) "+t),A=!0),A||this.find(".pvtVals .pvtAttrDropdownContainer"+o+" label.pvtAttrDropdown").each(function(){return t=rt[T].localeStrings[e]||rt.en.localeStrings[e]||e,tt(this).html("<b>"+b.displayName+"</b>) "+t)})}else r=i;if(0!==a)for(var d,c=(w=0)<=(d=a);c?w<d:w>d;c?w++:w--){var p=tt("<select>").addClass("pvtAttrDropdown"+o).addClass("pvtAttrDropdown").append(tt("<option>")).bind("change",()=>U());for(C of R)p.append(tt("<option>").val(C).text(C));r.append(p)}x.multiple&&!u&&tt("<a>").html("x").addClass("pvtRemoveAggregator").addClass("pvtToolButton").addClass("pvtAttrDropdown"+o).appendTo(r).bind("click",function(){return this.instance.find(".pvtVals .pvtAttrDropdownContainer"+this.aggIdx).remove(),l=N.findIndex(t=>t.id===this.aggIdx),N.splice(l,1),ot(N),U()}.bind({instance:this,aggIdx:o})),A&&(t=null!=s?s:x.vals,y=0,this.find(".pvtVals select.pvtAttrDropdown"+o).each(function(){return tt(this).val(t[y]),y++}),A=!1),n.push(t)}e.aggregatorName=N.map(t=>t.value),e.vals=n,e.aggregator=N.map((t,e)=>x.aggregators[t.value](n[e],x)),e.renderer=x.renderers[L.val()],e.rowOrder=W.data("order"),e.colOrder=Q.data("order"),x.multiple&&(e.aggregatorsLabel=N.map(t=>t.displayName));const h={},g=(this.find("input.pvtFilter").not(":checked").each(function(){var t=tt(this).data("filter");return null!=h[t[0]]?h[t[0]].push(t[1]):h[t[0]]=[t[1]]}),{});this.find("input.pvtFilter:checked").each(function(){var t=tt(this).data("filter");if(null!=h[t[0]])return null!=g[t[0]]?g[t[0]].push(t[1]):g[t[0]]=[t[1]]}),e.filter=function(t){if(!x.filter(t))return!1;for(var e in h)if(h[e].includes(""+(null!=t[e]?t[e]:"null")))return!1;return!0},I.pivot(k,e,T);var f,v=tt.extend({},x,{cols:e.cols,rows:e.rows,colOrder:e.colOrder,rowOrder:e.rowOrder,vals:n,exclusions:h,inclusions:g,aggregator:e.aggregator,inclusionsInfo:g,aggregatorName:e.aggregatorName,rendererName:L.val()}),m=e.pivotData;if(delete e.pivotData,this.data("pivotUIOptions",v),x.autoSortUnusedAttrs&&(f=this.find("td.pvtUnused.pvtAxisContainer"),tt(f).children("li").sort((t,e)=>at(tt(t).text(),tt(e).text())).appendTo(f)),I.css("opacity",1),null!=x.onRefresh)return x.onRefresh(v,m)},U=()=>(I.css("opacity",.5),setTimeout(Y,10));for(w of x.cols)this.find(".pvtCols").append(this.find(".axis_"+tt.inArray(w,p)));for(w of x.rows)this.find(".pvtRows").append(this.find(".axis_"+tt.inArray(w,p)));if(null!=x.aggregatorName)if(x.multiple){x.aggregatorName=Array.isArray(x.aggregatorName)?x.aggregatorName:[x.aggregatorName];for(let t=0;t<x.aggregatorName.length;t++){var J=x.aggregatorName[t];N.push({id:++l,value:J,vals:null!=x.vals?x.vals[t]:void 0}),ot(N)}}else this.find(".pvtVals").append(this.find(".pvtAttrDropdown")),this.find(".pvtAggregator").val(x.aggregatorName).change();else this.find(".pvtAggregator").change();null!=x.rendererName&&this.find(".pvtRenderer").val(x.rendererName),x.showUI||this.find(".pvtUiCell").hide(),U(),this.find(".pvtAxisContainer").sortable({update(t,e){if(null==e.sender)return U()},connectWith:this.find(".pvtAxisContainer"),items:"li",placeholder:"pvtPlaceholder"})}catch(t){console.error(t),this.html(x.localeStrings.uiRenderError)}return this},tt.fn.heatmap=function(t,e){null==t&&(t="heatmap");var a=this.data("numrows"),n=this.data("numcols");let l=e?.heatmap?.colorScaleGenerator;null==l&&(l=function(t){const e=Math.min(...t||[]),r=Math.max(...t||[]);return function(t){t=255-Math.round(255*(t-e)/(r-e));return`rgb(255,${t},${t})`}});var o=t=>{var e=e=>this.find(t).each(function(){var t=tt(this).data("value");if(null!=t&&isFinite(t))return e(t,tt(this))});const r=[],a=(e(t=>r.push(t)),l(r));return e((t,e)=>e.css("background-color",a(t)))};switch(t){case"heatmap":o(".pvtVal");break;case"rowheatmap":for(let t=0,e=a,r=0<=e;r?t<e:t>e;r?t++:t--)o(".pvtVal.row"+t);break;case"colheatmap":for(let t=0,e=n,r=0<=e;r?t<e:t>e;r?t++:t--)o(".pvtVal.col"+t)}return o(".pvtTotal.rowTotal"),o(".pvtTotal.colTotal"),this},tt.fn.barchart=function(t){var a=this.data("numrows"),n=(this.data("numcols"),t=>{var e=e=>this.find(t).each(function(){var t=tt(this).data("value");if(null!=t&&isFinite(t))return e(t,tt(this))});const r=[];e(t=>r.push(t));let a=Math.max(...r||[]),n=a=a<0?0:a;const o=Math.min(...r||[]),s=(o<0&&(n=a-o),t=>100*t/(1.4*n));return e(function(t,e){var r=e.text(),a=tt("<div>").css({position:"relative",height:"55px"});let n="gray",l=0;return o<0&&(l=s(-o)),t<0&&(l+=s(t),n="darkred",t=-t),a.append(tt("<div>").css({position:"absolute",bottom:l+"%",left:0,right:0,height:s(t)+"%","background-color":n})),a.append(tt("<div>").text(r).css({position:"relative","padding-left":"5px","padding-right":"5px"})),e.css({padding:0,"padding-top":"5px","text-align":"center"}).html(a)})});for(let t=0,e=a,r=0<=e;r?t<e:t>e;r?t++:t--)n(".pvtVal.row"+t);return n(".pvtTotal.colTotal"),this};function f(t){const e=t.find("tbody tr");return t=>tt(e[t])}const v=t=>Array.prototype.indexOf.call(t.parentNode.children,t),S=function(t,e){var r=1===t[0].length?1:-1,a=t[e].length,n=[];let l=t[e+=r];for(;l&&l.length>a;)l.length===a+1&&(n.push(e),e+=r,l=t[e]);return n},m=function(e,r){var a=1===e[0].length?1:-1,n=[];let l=e[r].length;for(;1<l;){let t;for(r-=a,t=e[r];t&&t.length>=l;)r-=a,t=e[r];n.push(r),l=e[r].length}return n},k=(t,e)=>t.filter(t=>t.length===e).map(t.indexOf.bind(t)),b=function(t,e,r){return e?t.find(`thead tr:last-child th.pvtAxisLabel:nth-of-type(${r})`):t.find(`thead tr:nth-child(${r}) th.pvtAxisLabel`)},C=(t,e,r)=>t.find(e?"tbody tr th.row"+r:"thead th.col"+r),y=function(t,e,r,a,n){var l,o=S(e,r);for(l in o){var s=o[l],i=t(s+a);(n?tt.fn.show:tt.fn.hide).call(i),i.hasClass("collapsed")||y(t,e,s,a,n)}return!0},M=function(t,e,r,a){var n,l=tt(t).closest("table"),o=v(t.parentNode),s=f(l),i=s(a),u=i.hasClass("collapsed")?s(t._old):i,d=(i.hasClass("collapsed")||(t._old=v(t.parentNode)),u.prepend(t),m(r,a));for(n in d){var c=d[n],c=C(l,e,c)[0],p=v(c.parentNode);c._old=null!=c._old?c._old:p,c._old===o&&1===c.rowSpan&&(c._old-=o-v(t.parentNode)),o===p&&u.prepend(c)}return R(t,e,r,a)},I=function(t,e,r,a,n){var l=tt(t).closest("table"),l=(e?f:function(t){const e=t.find("tr");return t=>e.find(".col"+t)})(l),o=e&&1<this.aggregator.length?1:0;return 1!==(null!=n?n[e?"rowSpan":"colSpan"]:void 0)&&y(l,r,a,o,l(a+o).hasClass("collapsed")),l(a+o).toggleClass("collapsed"),tt(t).toggleClass("open close")},T=function(t,e,r,a,n){let l;n&&1<r&&(b(e,a,r-1).removeClass("close").addClass("open"),T(t,e,r-1,a,n));var o=(a?t.rowAttrs:t.colAttrs).length-1;if(!n&&r<o)for(var s,i=r+1,u=(l=i)<=(s=o);u?l<=s:l>=s;u?l++:l--)b(e,a,l).removeClass("open").addClass("close");var i=a?t.rowKeys:t.colKeys,d=k(i,r);for(l in d){var c=d[l],c=C(e,a,c);n===c.hasClass("close")&&c.trigger("click")}return null},U=(r,a,n)=>function(t){var e=t.target.className.match(a?/row(\d+)/:/col(\d+)/);if(e)return n(t.target,a,r,+e[1])};F=(e,r,a)=>function(t){return T(e,tt(t.target).closest("table"),r+1,a,tt(t.target).hasClass("close")),tt(t.target).toggleClass("open close")}}(jQuery);
//# sourceMappingURL=pivot.min.js.map
