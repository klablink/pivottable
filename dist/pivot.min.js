!function(W){function R(t,e,r,a){let n;var l,o=W(t).closest("table"),s=e?"rowSpan":"colSpan",i=e?1:Math.max(1,this.aggregator.length),u=([t._span,t[s]]=[t[s],null!=t._span?t._span:i],t[s]-t._span),d=w(r,a);for(l in d){var p=d[l];if(1===(n=T(o,e,p)[0])[s]){n._span+=u;break}n[s]+=u}return I(t,e,r,a,n)}let F,i="en";function l(e){let r="";if(e)try{var t={year:"numeric",month:"2-digit",day:"2-digit"};r=new Date(e).toLocaleDateString(C||i,t)}catch(t){r=e}return r}function t(r){return r=W.extend({},{digitsAfterDecimal:2,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:""},r),function(t,e){return void 0===t?"":e===W.pivotUtilities.fieldsType.integer?t:e===W.pivotUtilities.fieldsType.date?l(t):W.isFunction(e)?e(t):isNaN(t)||!isFinite(t)?"":(e=function(t,e,r){t=(t+="").split(".");let a=t[0];for(var r=1<t.length?r+t[1]:"",n=/(\d+)(\d{3})/;n.test(a);)a=a.replace(n,"$1"+e+"$2");return a+r}((r.scaler*t).toFixed(r.digitsAfterDecimal),r.thousandsSep,r.decimalSep),""+r.prefix+e+r.suffix)}}let E={text:function(t,e,r,a){var n=this.fieldsType;return void 0===t&&(t=""),e&&n[e]===W.pivotUtilities.fieldsType.date?document.createTextNode(l(t)):document.createTextNode(t)},byType:function(r,a){return function(t,e){return(r[e]||a||E.text).apply(this,arguments)}}},e=t(),r=t({digitsAfterDecimal:0}),a=t({digitsAfterDecimal:1,scaler:100,suffix:"%"}),u={count(a){return null==a&&(a=r),()=>function(t,e,r){return{count:0,push(){return this.count++},value(){return this.count},format:a}}},uniques(n,l){return null==l&&(l=r),function(...t){let[a]=t[0];return function(t,e,r){return{attr:a,uniq:[],push(t){if(!this.uniq.includes(t[a]))return this.uniq.push(t[a])},value(){return n(this.uniq)},format:l,numInputs:null!=a?0:1}}}},sum(n){return null==n&&(n=e),function(...t){let[a]=t[0];return function(t,e,r){return{attr:a,sum:0,push(t){if(!isNaN(parseFloat(t[a])))return this.sum+=parseFloat(t[a])},value(){return this.sum},format:n,numInputs:null!=a?0:1}}}},extremes(l,o){return null==o&&(o=e),function(...t){let[a]=t[0],n=t[1]||{};return function(t,e,r){return{attr:a,val:null,sorter:X(null!=t?t.sorters:void 0,a),push(t){let e=t[a],r=this.val;n.rendererOptions?.fieldsType[a]===W.pivotUtilities.fieldsType.date?(e=new Date(e),r=r?new Date(r):e):["min","max"].includes(l)&&(e=parseFloat(e)),["min","max"].includes(l)&&!isNaN(e)&&(this.val=Math[l](e,null!=r?r:e)),"first"===l&&this.sorter(e,null!=r?r:e)<=0&&(this.val=e),"last"===l&&0<=this.sorter(e,null!=r?r:e)&&(this.val=e),n.rendererOptions?.fieldsType[a]===W.pivotUtilities.fieldsType.date&&(this.val=new Date(this.val).toISOString())},value(){return this.val},format(t,e){return isNaN(t)?t:o(t,e)},numInputs:null!=a?0:1}}}},quantile(n,l){return null==l&&(l=e),function(...t){let[a]=t[0];return function(t,e,r){return{attr:a,vals:[],push(t){t=parseFloat(t[a]);if(!isNaN(t))return this.vals.push(t)},value(){if(0===this.vals.length)return null;this.vals.sort((t,e)=>t-e);var t=(this.vals.length-1)*n;return(this.vals[Math.floor(t)]+this.vals[Math.ceil(t)])/2},format:l,numInputs:null!=a?0:1}}}},runningStat(n,l,o){return null==n&&(n="mean"),null==l&&(l=1),null==o&&(o=e),function(...t){let[a]=t[0];return function(t,e,r){return{attr:a,n:0,m:0,s:0,push(t){var e,t=parseFloat(t[a]);if(!isNaN(t))return this.n+=1,1===this.n?this.m=t:(e=this.m+(t-this.m)/this.n,this.s=this.s+(t-this.m)*(t-e),this.m=e)},value(){if("mean"===n)return 0===this.n?NaN:this.m;if(this.n<=l)return 0;switch(n){case"var":return this.s/(this.n-l);case"stdev":return Math.sqrt(this.s/(this.n-l))}},format:o,numInputs:null!=a?0:1}}}},sumOverSum(l){return null==l&&(l=e),function(...t){let[a,n]=t[0];return function(t,e,r){return{sumNum:0,sumDenom:0,push(t){if(isNaN(parseFloat(t[a]))||(this.sumNum+=parseFloat(t[a])),!isNaN(parseFloat(t[n])))return this.sumDenom+=parseFloat(t[n])},value(){return this.sumNum/this.sumDenom},format:l,numInputs:null!=a&&null!=n?0:2}}}},sumOverSumBound80(l,o){return null==l&&(l=!0),null==o&&(o=e),function(...t){let[a,n]=t[0];return function(t,e,r){return{sumNum:0,sumDenom:0,push(t){if(isNaN(parseFloat(t[a]))||(this.sumNum+=parseFloat(t[a])),!isNaN(parseFloat(t[n])))return this.sumDenom+=parseFloat(t[n])},value(){var t=l?1:-1;return(.821187207574908/this.sumDenom+this.sumNum/this.sumDenom+1.2815515655446004*t*Math.sqrt(.410593603787454/(this.sumDenom*this.sumDenom)+this.sumNum*(1-this.sumNum/this.sumDenom)/(this.sumDenom*this.sumDenom)))/(1+1.642374415149816/this.sumDenom)},format:o,numInputs:null!=a&&null!=n?0:2}}}},fractionOf(n,l,o){return null==l&&(l="total"),null==o&&(o=a),(...a)=>function(e,t,r){return{selector:{total:[[],[]],row:[t,[]],col:[[],r]}[l],inner:n(...a||[])(e,t,r),push(t){return this.inner.push(t)},format:o,value(t){t=e.getAggregator(...this.selector,t);return this.inner.value()/t.inner.value()},numInputs:n(...a||[])().numInputs}}}};function o(t,e,r){return{Count:u.count(e),"Count Unique Values":u.countUnique(e),"List Unique Values":u.listUnique(", "),Sum:u.sum(t),"Integer Sum":u.sum(e),Average:u.average(t),Median:u.median(t),"Sample Variance":u.var(1,t),"Sample Standard Deviation":u.stdev(1,t),Minimum:u.min(t),Maximum:u.max(t),First:u.first(t),Last:u.last(t),"Sum over Sum":u.sumOverSum(t),"80% Upper Bound":u.sumOverSumBound80(!0,t),"80% Lower Bound":u.sumOverSumBound80(!1,t),"Sum as Fraction of Total":u.fractionOf(u.sum(),"total",r),"Sum as Fraction of Rows":u.fractionOf(u.sum(),"row",r),"Sum as Fraction of Columns":u.fractionOf(u.sum(),"col",r),"Count as Fraction of Total":u.fractionOf(u.count(),"total",r),"Count as Fraction of Rows":u.fractionOf(u.count(),"row",r),"Count as Fraction of Columns":u.fractionOf(u.count(),"col",r)}}u.countUnique=t=>u.uniques(t=>t.length,t),u.listUnique=e=>u.uniques(t=>t.sort(Y).join(e),t=>t),u.max=t=>u.extremes("max",t),u.min=t=>u.extremes("min",t),u.first=t=>u.extremes("first",t),u.last=t=>u.extremes("last",t),u.median=t=>u.quantile(.5,t),u.average=t=>u.runningStat("mean",1,t),u.var=(t,e)=>u.runningStat("var",t,e),u.stdev=(t,e)=>u.runningStat("stdev",t,e);let s=o(e,r,a),b={Table(t,e){return v(t,e)},"Table Barchart"(t,e){return W(v(t,e)).barchart()},Heatmap(t,e){return W(v(t,e)).heatmap("heatmap",e)},"Row Heatmap"(t,e){return W(v(t,e)).heatmap("rowheatmap",e)},"Col Heatmap"(t,e){return W(v(t,e)).heatmap("colheatmap",e)}};var n,C="en";let Q={en:{formatters:{format:e,formatInt:r,formatPct:a},renderers:b,localeStrings:{renderError:"An error occurred rendering the PivotTable results.",computeError:"An error occurred computing the PivotTable results.",uiRenderError:"An error occurred rendering the PivotTable UI.",selectAll:"Select All",selectNone:"Select None",tooMany:"(too many to list)",filterResults:"Filter values",apply:"Apply",cancel:"Cancel",totals:"Totals",vs:"vs",by:"by",rendererLabel:"Renderer",valuesLabel:"Values",fieldsLabel:"Fields",colsLabel:"Columns",rowsLabel:"Rows",groupsLabel:"Groups"}}};for(n of Object.keys(s))Q.en.localeStrings[n]=n;let S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],k=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],d=(t,e=2)=>("0"+t).substr(-e,e),p=/(\d+)|(\D+)/g,c=/\d/,h=/^0/,Y=(t,e,r)=>{r=(r=null==r?!0:r)?1:-1;if(null!=e&&null==t)return-1*r;if(null!=t&&null==e)return r;if("number"==typeof t&&isNaN(t))return-1;if("number"==typeof e&&isNaN(e))return 1;var r=+t,a=+e;if(r<a)return-1;if(a<r)return 1;if("number"==typeof t&&"number"!=typeof e)return-1;if("number"==typeof e&&"number"!=typeof t)return 1;if("number"==typeof t&&"number"==typeof e)return 0;if(isNaN(a)&&!isNaN(r))return-1;if(isNaN(r)&&!isNaN(a))return 1;let n=String(t),l=String(e);if(n===l)return 0;if(!c.test(n)||!c.test(l))return n>l?1:-1;for(n=n.match(p),l=l.match(p);n.length&&l.length;){var o=n.shift(),s=l.shift();if(o!==s)return c.test(o)&&c.test(s)?o.replace(h,".0")-s.replace(h,".0"):s<o?1:-1}return n.length-l.length};function X(t,e){if(null!=t)if(W.isFunction(t)){var r=t(e);if(W.isFunction(r))return r}else if(null!=t[e])return t[e];return Y}let g=(t,e)=>t.filter(t=>t.length===e),f=r=>r.map((t,e)=>r.slice(0,e+1));class Z{constructor(t,e){this.arrSort=this.arrSort.bind(this),this.sortKeys=this.sortKeys.bind(this),this.getColKeys=this.getColKeys.bind(this),this.getRowKeys=this.getRowKeys.bind(this),this.getAggregator=this.getAggregator.bind(this),null==e&&(e={}),this.input=t,Array.isArray(e.aggregator)||(e.aggregator=null!=e.aggregator?e.aggregator:u.count()(),e.aggregator=[e.aggregator]),this.aggregator=null!=e.aggregator?e.aggregator:[u.count()()],this.aggregatorName=null!=e.aggregatorName?e.aggregatorName:"Count",this.colAttrs=null!=e.cols?e.cols:[],this.rowAttrs=null!=e.rows?e.rows:[],this.valAttrs=null!=e.vals?e.vals:[],this.sorters=null!=e.sorters?e.sorters:{},this.rowOrder=null!=e.rowOrder?e.rowOrder:"key_a_to_z",this.colOrder=null!=e.colOrder?e.colOrder:"key_a_to_z",this.derivedAttributes=null!=e.derivedAttributes?e.derivedAttributes:{},this.filter=null!=e.filter?e.filter:()=>!0,this.tree={},this.rowKeys=[],this.colKeys=[],this.rowTotals={},this.colTotals={},this.allTotal=this.aggregator.map(t=>t(this,[],[])),this.sorted=!1,this.aggregatorsLabel=null!=e.aggregatorsLabel?e.aggregatorsLabel:[],this.grouping=null!=e.grouping&&e.grouping,this.rowGroupBefore=null==(null!=e.grouping?e.grouping.rowGroupBefore:void 0)||(null!=e.grouping?e.grouping.rowGroupBefore:void 0),this.colGroupBefore=null!=(null!=e.grouping?e.grouping.colGroupBefore:void 0)&&(null!=e.grouping?e.grouping.colGroupBefore:void 0),Z.forEachRecord(this.input,this.derivedAttributes,t=>{if(this.filter(t))return this.processRecord((r=t,Object.entries(r).forEach(([t,e])=>{e instanceof Date&&(r[t]=e.toISOString())}),r));var r})}static forEachRecord(t,a,n){let l;if(l=W.isEmptyObject(a)?n:function(t){for(var e in a){var r=a[e];t[e]=r(t)||t[e]}return n(t)},W.isFunction(t))return t(l);if(W.isArray(t)){if(W.isArray(t[0])){var e,r=[];for(e of Object.keys(t||{})){var o=t[e];if(0<e){var s,i={};for(s of Object.keys(t[0]||{}))i[t[0][s]]=o[s];r.push(l(i))}}return r}var u,d=[];for(u of t)d.push(l(u));return d}if(t instanceof W){let r=[];return W("thead > tr > th",t).each(function(t){return r.push(W(this).text())}),W("tbody > tr",t).each(function(t){let e={};return W("td",this).each(function(t){return e[r[t]]=W(this).text()}),l(e)})}throw new Error("unknown input format")}forEachMatchingRecord(r,a){return Z.forEachRecord(this.input,this.derivedAttributes,t=>{if(this.filter(t)){for(var e in r)if(r[e]!==(null!=t[e]?t[e]:"null"))return;return a(t)}})}arrSort(t,a){let n=[];for(var e of t)n.push(X(this.sorters,e));return function(t,e){for(var r of Object.keys(n||{})){r=(0,n[r])(t[r],e[r],a);if(0!==r)return r}return 0}}sortKeys(){if(!this.sorted){this.sorted=!0;let r=(t,e)=>this.getAggregator(t,e).value();switch(this.rowOrder){case"value_a_to_z":this.rowKeys.sort((t,e)=>Y(r(t,[]),r(e,[])));break;case"value_z_to_a":this.rowKeys.sort((t,e)=>-Y(r(t,[]),r(e,[])));break;default:this.rowKeys.sort(this.arrSort(this.rowAttrs,this.rowGroupBefore))}switch(this.colOrder){case"value_a_to_z":return this.colKeys.sort((t,e)=>Y(r([],t),r([],e)));case"value_z_to_a":return this.colKeys.sort((t,e)=>-Y(r([],t),r([],e)));default:return this.colKeys.sort(this.arrSort(this.colAttrs,this.colGroupBefore))}}}getColKeys(t){return null==t&&(t=!1),this.sortKeys(),t?this.colKeys:g(this.colKeys,this.colAttrs.length)}getRowKeys(t){return null==t&&(t=!1),this.sortKeys(),t?this.rowKeys:g(this.rowKeys,this.rowAttrs.length)}processRecord(n){let t,e=[],r=[];for(t of this.colAttrs)e.push(null!=n[t]?n[t]:"null");for(t of this.rowAttrs)r.push(null!=n[t]?n[t]:"null");e=this.grouping&&e.length?f(e):[e],r=this.grouping&&r.length?f(r):[r],this.aggregator.forEach((t,e)=>this.allTotal[e].push(n));var l,o=[];for(l in r){let a=r[l];var s,i=a.join(String.fromCharCode(0)),u=[];for(s in e){let r=e[s];var d=r.join(String.fromCharCode(0));0!==a.length&&(this.rowTotals[i]||(this.rowKeys.push(a),this.rowTotals[i]=this.aggregator.map(t=>t(this,a,[]))),this.rowTotals[i].forEach((t,e)=>{if(!this.grouping||1===r.length)return t.push(n)})),0!==r.length&&(this.colTotals[d]||(this.colKeys.push(r),this.colTotals[d]=this.aggregator.map(t=>t(this,[],r))),this.colTotals[d].forEach((t,e)=>{if(!this.grouping||1===a.length)return t.push(n)})),0!==r.length&&0!==a.length?(this.tree[i]||(this.tree[i]={}),this.tree[i][d]||(this.tree[i][d]=this.aggregator.map(t=>t(this,a,r))),u.push(this.tree[i][d].forEach((t,e)=>t.push(n)))):u.push(void 0)}o.push(u)}return o}getAggregator(t,e,r){let a;null==r&&(r=0);var n=t.join(String.fromCharCode(0)),l=e.join(String.fromCharCode(0));return null!=(a=0===t.length&&0===e.length?this.allTotal[r]:0===t.length?this.colTotals[l]&&this.colTotals[l][r]:0===e.length?this.rowTotals[n]&&this.rowTotals[n][r]:this.tree[n][l]&&this.tree[n][l][r])?a:{value(){return null},format(){return""}}}}let tt=t=>t.map((t,e)=>t.displayName=String.fromCharCode(97+e).toUpperCase());function v(o,s){let t,e,r,a,n,l,i,u,d,p,c,h,g;var f={table:{clickCallback:null,rowTotals:!0,colTotals:!0},localeStrings:{totals:"Totals"},typeCellRenderer:E.text,headCellRenderer:E.text,dataCellRenderer:E.text,fieldsType:{}};s=W.extend(!0,{},f,s);let v=o.colAttrs,m=o.rowAttrs;function b(e,r,a){let n;if(0!==r){var l,o;let t=!0;for(l=(n=0)<=(o=a);l?n<=o:n>=o;l?n++:n--)e[r-1][n]!==e[r][n]&&(t=!1);if(t)return-1}let s=0;for(;r+s<e.length;){var i,u;let t=!1;for(i=(n=0)<=(u=a);i?n<=u:n>=u;i?n++:n--)e[r][n]!==e[r+s][n]&&(t=!0);if(t)break;s++}return s}var C=o.getRowKeys(!0),y=o.getColKeys(!0),w=(s.table.clickCallback&&(a=function(e,t,r){let a,n,l={};for(n of Object.keys(v||{}))a=v[n],null!=r[n]&&(l[a]=r[n]);for(n of Object.keys(m||{}))a=m[n],null!=t[n]&&(l[a]=t[n]);return t=>s.table.clickCallback(t,e,l,o)}),(null==s.table.compactLayout||s.table.compactLayout)&&o.grouping),f=w?I:o.rowGroupBefore?R:U,A=M(C,!0,f.bind(o)),T=M(y,!1,R.bind(o)),f=document.createElement("table"),x=(f.className="pvtTable",document.createElement("thead"));for(i of Object.keys(v||{})){var N=v[i];c=document.createElement("tr"),0===parseInt(i)&&0!==m.length&&((d=document.createElement("th")).setAttribute("colspan",m.length),d.setAttribute("rowspan",v.length),c.appendChild(d)),(d=document.createElement("th")).className="pvtAxisLabel",d.appendChild(s.typeCellRenderer.call(s,N)),o.grouping&&i<v.length-1&&(d.onclick=F(o,+i,!1),d.className+=" open level"+i),c.appendChild(d);for(n of Object.keys(y||{}))r=y[n],-1!==(g=b(y,parseInt(n),parseInt(i)))&&((d=document.createElement("th")).className="pvtColLabel",d.className+=" col"+(o.colGroupBefore?+n:+n+g-1),d.appendChild(s.headCellRenderer.call(s,r[i],N)),d.setAttribute("colspan",g*Math.max(1,o.aggregator.length)),parseInt(i)===v.length-1&&0!==m.length&&d.setAttribute("rowspan",2),o.grouping&&i<v.length-1&&r[i]&&(d.className+=" pvtSubtotal open",d.setAttribute("colspan",g*Math.max(1,o.aggregator.length)),d.onclick=T),c.appendChild(d));0===parseInt(i)&&s.table.rowTotals&&((d=document.createElement("th")).className="pvtTotalLabel pvtRowTotalLabel",d.innerHTML=s.localeStrings.totals,d.setAttribute("colspan",Math.max(1,o.aggregator.length)),d.setAttribute("rowspan",v.length+(0===m.length?0:1)),c.appendChild(d)),x.appendChild(c)}if(0!==m.length){c=document.createElement("tr");for(n of Object.keys(m||{})){var S=m[n];(d=document.createElement("th")).className="pvtAxisLabel",d.appendChild(s.typeCellRenderer.call(s,S)),o.grouping&&n<m.length-1&&(d.className+=" open level"+n,d.onclick=F(o,+n,!0)),c.appendChild(d)}d=document.createElement("th"),0===v.length&&(d.className="pvtTotalLabel pvtRowTotalLabel",d.innerHTML=s.localeStrings.totals,d.setAttribute("colspan",o.aggregator.length)),c.appendChild(d),x.appendChild(c)}f.appendChild(x);var k=document.createElement("tbody");if(o.aggregatorsLabel&&1<o.aggregatorsLabel.length){let t;c=document.createElement("tr"),d=document.createElement("th");var O=m.length+(0===v.length?0:1);d.setAttribute("colspan",O),c.appendChild(d);for(i of Object.keys(y||{})){r=y[i];for(t of o.aggregatorsLabel)(d=document.createElement("th")).className="pvtAggregatorLabel col"+i,d.textContent=t,c.appendChild(d)}for(t of o.aggregatorsLabel)(d=document.createElement("th")).className="pvtAggregatorLabel",d.textContent=t,c.appendChild(d);k.appendChild(c)}for(n of Object.keys(C||{})){var _=C[n],D=(c=document.createElement("tr"),m.length-_.length);c.className=D?"pvtSubtotal level"+_.length:"pvtData";for(i of Object.keys(_||{})){var L=_[i];w&&i<_.length-1||-1!==(g=w?1:b(C,parseInt(n),parseInt(i)))&&((d=document.createElement("th")).className="pvtRowLabel",d.className+=" row"+(o.rowGroupBefore?+n:+n+g-1),d.appendChild(s.headCellRenderer.call(s,L,m[i])),d.setAttribute("rowspan",g),w&&(d.colSpan=m.length,d.style.paddingLeft=5+20*parseInt(i)+"px"),o.grouping&&i<m.length-1&&(d.className+=" open",d.onclick=A),c.appendChild(d))}!w&&D&&((d=document.createElement("th")).colSpan=D,d.textContent=`Total (${_[i]})`,c.appendChild(d)),v.length&&d.colSpan++;for(i of Object.keys(y||{}))for(r=y[i],l=0;l<o.aggregator.length;l++)t=o.aggregator[l],e=o.getAggregator(_,r,l),h=e.value(l),u=document.createElement("td"),D||(u.className="pvtVal "),u.className+=`row${n} col`+i,v.length-r.length&&(u.className=`pvtSubtotal level${r.length} row${n} col`+i),u.appendChild(s.dataCellRenderer.call(s,e.format(h,s.fieldsType[e?.attr]),e?.attr,_,r)),u.setAttribute("data-value",h),null!=a&&(u.onclick=a(h,_,r)),c.appendChild(u);if(s.table.rowTotals||0===v.length)for(l=0;l<o.aggregator.length;l++)t=o.aggregator[l],p=o.getAggregator(_,[],l),h=p.value(l),(u=document.createElement("td")).className="pvtTotal rowTotal",u.append(s.dataCellRenderer.call(s,p.format(h,s.fieldsType[p?.attr]),p?.attr,_,[])),u.setAttribute("data-value",h),null!=a&&(u.onclick=a(h,_,[])),u.setAttribute("data-for","row"+n),c.appendChild(u);k.appendChild(c)}if(s.table.colTotals||0===m.length){c=document.createElement("tr"),!s.table.colTotals&&0!==m.length||((d=document.createElement("th")).className="pvtTotalLabel pvtColTotalLabel",d.innerHTML=s.localeStrings.totals,d.setAttribute("colspan",m.length+(0===v.length?0:1)),c.appendChild(d));for(i of Object.keys(y||{}))for(r=y[i],l=0;l<o.aggregator.length;l++)t=o.aggregator[l],p=o.getAggregator([],r,l),h=p.value(l),(u=document.createElement("td")).className="pvtTotal colTotal col"+i,r.length!==v.length&&(u.className+=" pvtSubtotal level"+r.length),u.append(s.dataCellRenderer.call(s,p.format(h,s.fieldsType[p?.attr]),p?.attr,[],r)),u.setAttribute("data-value",h),null!=a&&(u.onclick=a(h,[],r)),u.setAttribute("data-for","col"+i),c.appendChild(u);if(s.table.rowTotals||0===v.length)for(l=0;l<o.aggregator.length;l++)t=o.aggregator[l],p=o.getAggregator([],[],l),h=p.value(l),(u=document.createElement("td")).className="pvtGrandTotal",u.append(s.dataCellRenderer.call(s,p.format(h,s.fieldsType[p?.attr]),p?.attr,[],[])),u.setAttribute("data-value",h),null!=a&&(u.onclick=a(h,[],[])),c.appendChild(u);k.appendChild(c)}return f.appendChild(k),f.setAttribute("data-numrows",C.length),f.setAttribute("data-numcols",y.length),f}W.pivotUtilities={aggregatorTemplates:u,aggregators:s,renderers:b,cellRenderers:E,derivers:{bin(e,r){return t=>t[e]-t[e]%r},dateFormat(e,a,t,n,l){null==t&&(t=!1),null==n&&(n=S),null==l&&(l=k);let o=t?"UTC":"";return function(t){let r=new Date(Date.parse(t[e]));return isNaN(r)?"":a.replace(/%(.)/g,function(t,e){switch(e){case"y":return r[`get${o}FullYear`]();case"m":return d(r[`get${o}Month`]()+1);case"n":return n[r[`get${o}Month`]()];case"d":return d(r[`get${o}Date`]());case"w":return l[r[`get${o}Day`]()];case"x":return r[`get${o}Day`]();case"H":return d(r[`get${o}Hours`]());case"M":return d(r[`get${o}Minutes`]());case"S":return d(r[`get${o}Seconds`]());default:return"%"+e}})}}},locales:Q,fieldsType:{string:"String",number:"Number",date:"Date",time:"Time",datetime:"Datetime",boolean:"Boolean",integer:"Integer"},zeroPad:d,naturalSort:Y,numberFormat:t,sortAs:function(t){let r={},a={};for(var e in t){var n=t[e];r[n]=e,"string"==typeof n&&(a[n.toLowerCase()]=e)}return function(t,e){return null!=r[t]&&null!=r[e]?r[t]-r[e]:null!=r[t]?-1:null!=r[e]?1:null!=a[t]&&null!=a[e]?a[t]-a[e]:null!=a[t]?-1:null!=a[e]?1:Y(t,e)}},PivotData:Z},W.fn.pivot=function(t,e,r){let a;-1<r.indexOf("/")&&(r=(n=r.split("/"))[0],C=n[1]),null==r&&(r="en"),null==Q[r]&&(r="en"),0===C.length&&(C=r),i=r,e=e||{};var n={cols:[],rows:[],vals:[],rowOrder:"key_a_to_z",colOrder:"key_a_to_z",dataClass:Z,filter(){return!0},aggregator:u.count()(),aggregatorName:"Count",sorters:{},derivedAttributes:{},renderer:v},r=W.extend(!0,{},Q.en.localeStrings,Q[r].localeStrings),r=W.extend(!0,{},{rendererOptions:{localeStrings:r},localeStrings:r},W.extend({},n,e));let l;e.pivotData=null;try{var o=new r.dataClass(t,r);try{l=r.renderer(o,r.rendererOptions),e.pivotData=o}catch(t){a=t,"undefined"!=typeof console&&null!==console&&console.error(a.stack),l=W("<span>").html(r.localeStrings.renderError)}}catch(t){a=t,"undefined"!=typeof console&&null!==console&&console.error(a.stack),l=W("<span>").html(r.localeStrings.computeError)}for(var s=this[0];s.hasChildNodes();)s.removeChild(s.lastChild);return this.append(l)},W.fn.pivotUI=function(u,t,e,_){let D,d,p;null==e&&(e=!1),-1<_.indexOf("/")&&(_=(r=_.split("/"))[0],C=r[1]),null==_&&(_="fr"),null==Q[_]&&(_="en");var r={derivedAttributes:{},aggregators:s,renderers:b,hiddenAttributes:[],hiddenFromAggregators:[],hiddenFromDragDrop:[],menuLimit:500,cols:[],rows:[],vals:[],rowOrder:"key_a_to_z",colOrder:"key_a_to_z",dataClass:Z,exclusions:{},inclusions:{},unusedAttrsVertical:85,autoSortUnusedAttrs:!1,onRefresh:null,showUI:!0,filter(){return!0},sorters:{},multiple:!0,parametersActive:!1};let c=0,L=[];var h=W.extend(!0,{},Q.en.localeStrings,Q[_].localeStrings),a={rendererOptions:{localeStrings:h},localeStrings:h},n=this.data("pivotUIOptions");D=null==n||e?W.extend(!0,{},a,W.extend({},r,t)):n,!t?.aggregators&&Q[C].formatters&&(D.aggregators=o(Q[C].formatters.format,Q[C].formatters.formatInt,Q[C].formatters.formatPct));try{let b,C,e,y,n={},w=[],a=0;Z.forEachRecord(u,D.derivedAttributes,function(t){let e;if(D.filter(t)){w.push(t);for(e of Object.keys(t||{}))null==n[e]&&(n[e]={},0<a)&&(n[e].null=a);for(e in n){var r=null!=t[e]?t[e]:"null";null==n[e][r]&&(n[e][r]=0),n[e][r]++}return a++}});var g=W("<div>").addClass("pvtUi"),f=W("<div>").addClass("pvtUiMenu");let t=W("<div>").addClass("pvtUiParameters");var v=W("<div>").addClass("pvtUiContainer");let r=W("<div>").addClass("pvtUiVerticalButton").addClass("pvtUiButtonColumns").addClass("active").text(h.colsLabel).on("click",function(){return D.parametersActive=!D.parametersActive,D.parametersActive?(r.addClass("active"),t.show()):(r.removeClass("active"),t.hide())}).appendTo(f),l=W("<div>").addClass("pvtUiVerticalButton").addClass("pvtUiButtonGroups").text(h.groupsLabel).on("click",function(){return D.grouping?(l.removeClass("active"),D.grouping=!1):(l.addClass("active"),D.grouping={colGroupBefore:!1}),O()}).appendTo(f);g.append(f).append(t).append(v),W("<div>").addClass("pvtParameterLabel").appendTo(t).text(h.rendererLabel);var m=W("<div>").addClass("pvtRendererType").addClass("pvtParameter").appendTo(t);let A=W("<select>").addClass("pvtRenderer").appendTo(m).bind("change",()=>O());for(y of Object.keys(D.renderers||{})){var R=D.localeStrings[y]||y;W("<option>").val(y).html(R).appendTo(A)}var F=W("<div>").addClass("pvtAxisContainer pvtUnused"),E=[];for(d in n)D.hiddenAttributes.includes(d)||E.push(d);let T=[];for(p of E)D.hiddenFromAggregators.includes(p)||T.push(p);var I=[];for(p of E)D.hiddenFromDragDrop.includes(p)||I.push(p);if(e="auto"===D.unusedAttrsVertical?120:parseInt(D.unusedAttrsVertical),!isNaN(e)){let t=0;for(d of I)t+=d.length;t,e}for(C of Object.keys(I||{})){b=I[C];var U,M=[];for(U in n[b])M.push(U);let e=!1,r=W("<div>").addClass("pvtFilterBox").hide();if(r.append(W("<h4>").append(W("<span>").text(b),W("<span>").addClass("count").text(`(${M.length})`))),M.length>D.menuLimit)r.append(W("<p>").html(D.localeStrings.tooMany));else{if(5<M.length){var B=W("<p>").appendTo(r);let l=X(D.sorters,b);var K=D.localeStrings.filterResults;W("<input>",{type:"text"}).appendTo(B).attr({placeholder:K,class:"pvtSearch"}).bind("keyup",function(){let n=W(this).val().toLowerCase().trim();var t=(r,a)=>function(t){var e=n.substring(r.length).trim();return 0===e.length||a.includes(Math.sign(l(t.toLowerCase(),e)))};let e=0===n.indexOf(">=")?t(">=",[1,0]):0===n.indexOf("<=")?t("<=",[-1,0]):0===n.indexOf(">")?t(">",[1]):0===n.indexOf("<")?t("<",[-1]):0===n.indexOf("~")?function(t){return 0===n.substring(1).trim().length||t.toLowerCase().match(n.substring(1))}:t=>-1!==t.toLowerCase().indexOf(n);return r.find(".pvtCheckContainer p label span.value").each(function(){return e(W(this).text())?W(this).parent().parent().show():W(this).parent().parent().hide()})}),B.append(W("<br>")),W("<button>",{type:"button"}).appendTo(B).html(D.localeStrings.selectAll).bind("click",function(){return r.find("input:visible:not(:checked)").prop("checked",!0).toggleClass("changed"),!1}),W("<button>",{type:"button"}).appendTo(B).html(D.localeStrings.selectNone).bind("click",function(){return r.find("input:visible:checked").prop("checked",!1).toggleClass("changed"),!1})}var j,V=W("<div>").addClass("pvtCheckContainer").appendTo(r);for(j of M.sort(X(D.sorters,b))){var $=n[b][j],q=W("<label>");let t=!1;D.inclusions[b]?t=!D.inclusions[b].includes(j):D.exclusions[b]&&(t=D.exclusions[b].includes(j)),e=e||t,W("<input>").attr("type","checkbox").addClass("pvtFilter").attr("checked",!t).data("filter",[b,j]).appendTo(q).bind("change",function(){return W(this).toggleClass("changed")}),q.append(W("<span>").addClass("value").text(j)),q.append(W("<span>").addClass("count").text("("+$+")")),V.append(W("<p>").append(q))}}let t=function(){return r.find("[type='checkbox']").length>r.find("[type='checkbox']:checked").length?a.addClass("pvtFilteredAttribute"):a.removeClass("pvtFilteredAttribute"),r.find(".pvtSearch").val(""),r.find(".pvtCheckContainer p").show(),r.hide()};var z=W("<p>").appendTo(r),P=(M.length<=D.menuLimit&&W("<button>",{type:"button"}).text(D.localeStrings.apply).appendTo(z).bind("click",function(){return r.find(".changed").removeClass("changed").length&&O(),t()}),W("<button>",{type:"button"}).text(D.localeStrings.cancel).appendTo(z).bind("click",function(){return r.find(".changed:checked").removeClass("changed").prop("checked",!1),r.find(".changed:not(:checked)").removeClass("changed").prop("checked",!0),t()}),W("<span>").addClass("pvtTriangle").html(" &#x25BE;").bind("click",function(t){var{left:t,top:e}=W(t.currentTarget).position();return r.css({left:t+10,top:e+10}).show()}));let a=W("<li>").addClass("axis_"+C).append(W("<span>").addClass("pvtAttr").text(b).data("attrName",b).append(P));e&&a.addClass("pvtFilteredAttribute"),F.append(a).append(r)}W("<div>").addClass("pvtParameterLabel").appendTo(t).text(h.valuesLabel);var G=W("<div>").addClass("pvtAggregatorChoose").addClass("pvtParameter").appendTo(t);let o=W("<select>").addClass("pvtAggregator").appendTo(G).bind("change",()=>{if(!D.multiple)return this.find(".pvtVals .pvtAttrDropdown").each(function(){return this.remove()}),L=[{id:1,value:o.val()}],O()});for(y of Object.keys(D.aggregators||{}))o.append(W("<option>").val(y).html(Q[_].localeStrings[y]||Q.en.localeStrings[y]||y));D.multiple&&W("<a>",{role:"button"}).addClass("pvtAddAggregator").addClass("pvtToolButton").appendTo(G).html("+").bind("click",function(){return L.push({id:++c,value:o.val()}),tt(L),O()});let s={key_a_to_z:{rowSymbol:"&varr;",colSymbol:"&harr;",next:"value_a_to_z"},value_a_to_z:{rowSymbol:"&darr;",colSymbol:"&rarr;",next:"value_z_to_a"},value_z_to_a:{rowSymbol:"&uarr;",colSymbol:"&larr;",next:"key_a_to_z"}},x=W("<a>",{role:"button"}).addClass("pvtRowOrder").addClass("pvtToolButton").appendTo(G).data("order",D.rowOrder).html(s[D.rowOrder].rowSymbol).bind("click",function(){return W(this).data("order",s[W(this).data("order")].next),W(this).html(s[W(this).data("order")].rowSymbol),O()}),N=W("<a>",{role:"button"}).addClass("pvtColOrder").addClass("pvtToolButton").appendTo(G).data("order",D.colOrder).html(s[D.colOrder].colSymbol).bind("click",function(){return W(this).data("order",s[W(this).data("order")].next),W(this).html(s[W(this).data("order")].colSymbol),O()});var H=W("<div>").addClass("pvtVals").addClass("pvtParameter").appendTo(t);t.append(H),W("<div>").addClass("pvtParameterLabel").appendTo(t).text(h.fieldsLabel),t.append(F),W("<div>").addClass("pvtParameterLabel").appendTo(t).text(h.colsLabel),W("<div>").addClass("pvtAxisContainer pvtCols").appendTo(t),W("<div>").addClass("pvtParameterLabel").appendTo(t).text(h.rowsLabel),W("<div>").addClass("pvtAxisContainer pvtRows").appendTo(t);let S=W("<div>").addClass("pvtRendererArea").appendTo(v),k=(this.html(g),D.parametersActive||(r.removeClass("active"),t.hide()),!0),i=()=>{let t,e={derivedAttributes:D.derivedAttributes,localeStrings:D.localeStrings,rendererOptions:D.rendererOptions,sorters:D.sorters,cols:[],rows:[],dataClass:D.dataClass,grouping:D.grouping},n=(this.find(".pvtRows li span.pvtAttr").each(function(){return e.rows.push(W(this).data("attrName"))}),this.find(".pvtCols li span.pvtAttr").each(function(){return e.cols.push(W(this).data("attrName"))}),0),l=[],r=0,o=r;for(;r<L.length;r++,o=r){let e,r=L[o];"object"==typeof r&&(e=r.value);var s=r.id,i=r.vals,u=(n=D.aggregators[e]([])().numInputs||0,t=[],this.find(".pvtVals select.pvtAttrDropdown"+s).each(function(){if(0!==n&&(n--,""!==W(this).val()))return t.push(W(this).val())}),this.find(".pvtVals"));let a=this.find(".pvtVals .pvtAttrDropdownContainer"+s);var d=0<a.length;if(D.multiple){let t;d||(a=W("<div>").addClass("pvtAttrDropdownContainer").addClass("pvtAttrDropdownContainer"+s).appendTo(u),t=Q[_].localeStrings[e]||Q.en.localeStrings[e]||e,W("<label>").addClass("pvtAttrDropdown").addClass("pvtAttrDropdown"+s).appendTo(a).html("<b>"+r.displayName+"</b>) "+t),k=!0),k||this.find(".pvtVals .pvtAttrDropdownContainer"+s+" label.pvtAttrDropdown").each(function(){return t=Q[_].localeStrings[e]||Q.en.localeStrings[e]||e,W(this).html("<b>"+r.displayName+"</b>) "+t)})}else a=u;if(0!==n)for(var p,c=(y=0)<=(p=n);c?y<p:y>p;c?y++:y--){var h=W("<select>").addClass("pvtAttrDropdown"+s).addClass("pvtAttrDropdown").append(W("<option>")).bind("change",()=>O());for(b of T)h.append(W("<option>").val(b).text(b));a.append(h)}D.multiple&&!d&&W("<a>").html("x").addClass("pvtRemoveAggregator").addClass("pvtToolButton").addClass("pvtAttrDropdown"+s).appendTo(a).bind("click",function(){return this.instance.find(".pvtVals .pvtAttrDropdownContainer"+this.aggIdx).remove(),o=L.findIndex(t=>t.id===this.aggIdx),L.splice(o,1),tt(L),O()}.bind({instance:this,aggIdx:s})),k&&(t=null!=i?i:D.vals,C=0,this.find(".pvtVals select.pvtAttrDropdown"+s).each(function(){return W(this).val(t[C]),C++}),k=!1),l.push(t)}e.aggregatorName=L.map(t=>t.value),e.vals=l,e.aggregator=L.map((t,e)=>D.aggregators[t.value](l[e],D)),e.renderer=D.renderers[A.val()],e.rowOrder=x.data("order"),e.colOrder=N.data("order"),D.multiple&&(e.aggregatorsLabel=L.map(t=>t.displayName));let a={},g=(this.find("input.pvtFilter").not(":checked").each(function(){var t=W(this).data("filter");return null!=a[t[0]]?a[t[0]].push(t[1]):a[t[0]]=[t[1]]}),{});this.find("input.pvtFilter:checked").each(function(){var t=W(this).data("filter");if(null!=a[t[0]])return null!=g[t[0]]?g[t[0]].push(t[1]):g[t[0]]=[t[1]]}),e.filter=function(t){if(!D.filter(t))return!1;for(var e in a)if(a[e].includes(""+(null!=t[e]?t[e]:"null")))return!1;return!0},S.pivot(w,e,_);var f,v=W.extend({},D,{cols:e.cols,rows:e.rows,colOrder:e.colOrder,rowOrder:e.rowOrder,vals:l,exclusions:a,inclusions:g,aggregator:e.aggregator,inclusionsInfo:g,aggregatorName:e.aggregatorName,rendererName:A.val()}),m=e.pivotData;if(delete e.pivotData,this.data("pivotUIOptions",v),D.autoSortUnusedAttrs&&(f=this.find("td.pvtUnused.pvtAxisContainer"),W(f).children("li").sort((t,e)=>Y(W(t).text(),W(e).text())).appendTo(f)),S.css("opacity",1),null!=D.onRefresh)return D.onRefresh(v,m)},O=()=>(S.css("opacity",.5),setTimeout(i,10));for(y of D.cols)this.find(".pvtCols").append(this.find(".axis_"+W.inArray(y,I)));for(y of D.rows)this.find(".pvtRows").append(this.find(".axis_"+W.inArray(y,I)));if(null!=D.aggregatorName)if(D.multiple){D.aggregatorName=Array.isArray(D.aggregatorName)?D.aggregatorName:[D.aggregatorName];for(let t=0;t<D.aggregatorName.length;t++){var J=D.aggregatorName[t];L.push({id:++c,value:J,vals:null!=D.vals?D.vals[t]:void 0}),tt(L)}}else this.find(".pvtVals").append(this.find(".pvtAttrDropdown")),this.find(".pvtAggregator").val(D.aggregatorName).change();else this.find(".pvtAggregator").change();null!=D.rendererName&&this.find(".pvtRenderer").val(D.rendererName),D.showUI||this.find(".pvtUiCell").hide(),O(),this.find(".pvtAxisContainer").sortable({update(t,e){if(null==e.sender)return O()},connectWith:this.find(".pvtAxisContainer"),items:"li",placeholder:"pvtPlaceholder"})}catch(t){console.error(t),this.html(D.localeStrings.uiRenderError)}return this},W.fn.heatmap=function(t,e){null==t&&(t="heatmap");var a=this.data("numrows"),n=this.data("numcols");let l=e?.heatmap?.colorScaleGenerator;null==l&&(l=function(t){let e=Math.min(...t||[]),r=Math.max(...t||[]);return function(t){t=255-Math.round(255*(t-e)/(r-e));return`rgb(255,${t},${t})`}});var o=t=>{var e=e=>this.find(t).each(function(){var t=W(this).data("value");if(null!=t&&isFinite(t))return e(t,W(this))});let r=[],a=(e(t=>r.push(t)),l(r));return e((t,e)=>e.css("background-color",a(t)))};switch(t){case"heatmap":o(".pvtVal");break;case"rowheatmap":for(let t=0,e=a,r=0<=e;r?t<e:t>e;r?t++:t--)o(".pvtVal.row"+t);break;case"colheatmap":for(let t=0,e=n,r=0<=e;r?t<e:t>e;r?t++:t--)o(".pvtVal.col"+t)}return o(".pvtTotal.rowTotal"),o(".pvtTotal.colTotal"),this},W.fn.barchart=function(t){var a=this.data("numrows"),n=(this.data("numcols"),t=>{var e=e=>this.find(t).each(function(){var t=W(this).data("value");if(null!=t&&isFinite(t))return e(t,W(this))});let r=[],a=(e(t=>r.push(t)),Math.max(...r||[])),n=a=a<0?0:a,o=Math.min(...r||[]),s=(o<0&&(n=a-o),t=>100*t/(1.4*n));return e(function(t,e){var r=e.text(),a=W("<div>").css({position:"relative",height:"55px"});let n="gray",l=0;return o<0&&(l=s(-o)),t<0&&(l+=s(t),n="darkred",t=-t),a.append(W("<div>").css({position:"absolute",bottom:l+"%",left:0,right:0,height:s(t)+"%","background-color":n})),a.append(W("<div>").text(r).css({position:"relative","padding-left":"5px","padding-right":"5px"})),e.css({padding:0,"padding-top":"5px","text-align":"center"}).html(a)})});for(let t=0,e=a,r=0<=e;r?t<e:t>e;r?t++:t--)n(".pvtVal.row"+t);return n(".pvtTotal.colTotal"),this};function m(t){let e=t.find("tbody tr");return t=>W(e[t])}let y=t=>Array.prototype.indexOf.call(t.parentNode.children,t),O=function(t,e){var r=1===t[0].length?1:-1,a=t[e].length,n=[];let l=t[e+=r];for(;l&&l.length>a;)l.length===a+1&&(n.push(e),e+=r,l=t[e]);return n},w=function(e,r){var a=1===e[0].length?1:-1,n=[];let l=e[r].length;for(;1<l;){let t;for(r-=a,t=e[r];t&&t.length>=l;)r-=a,t=e[r];n.push(r),l=e[r].length}return n},_=(t,e)=>t.filter(t=>t.length===e).map(t.indexOf.bind(t)),A=function(t,e,r){return e?t.find(`thead tr:last-child th.pvtAxisLabel:nth-of-type(${r})`):t.find(`thead tr:nth-child(${r}) th.pvtAxisLabel`)},T=(t,e,r)=>t.find(e?"tbody tr th.row"+r:"thead th.col"+r),x=function(t,e,r,a,n){var l,o=O(e,r);for(l in o){var s=o[l],i=t(s+a);(n?W.fn.show:W.fn.hide).call(i),i.hasClass("collapsed")||x(t,e,s,a,n)}return!0},U=function(t,e,r,a){var n,l=W(t).closest("table"),o=y(t.parentNode),s=m(l),i=s(a),u=i.hasClass("collapsed")?s(t._old):i,d=(i.hasClass("collapsed")||(t._old=y(t.parentNode)),u.prepend(t),w(r,a));for(n in d){var p=d[n],p=T(l,e,p)[0],c=y(p.parentNode);p._old=null!=p._old?p._old:c,p._old===o&&1===p.rowSpan&&(p._old-=o-y(t.parentNode)),o===c&&u.prepend(p)}return R(t,e,r,a)},I=function(t,e,r,a,n){var l=W(t).closest("table"),l=(e?m:function(t){let e=t.find("tr");return t=>e.find(".col"+t)})(l),o=e&&1<this.aggregator.length?1:0;return 1!==(null!=n?n[e?"rowSpan":"colSpan"]:void 0)&&x(l,r,a,o,l(a+o).hasClass("collapsed")),l(a+o).toggleClass("collapsed"),W(t).toggleClass("open close")},N=function(t,e,r,a,n){let l;n&&1<r&&(A(e,a,r-1).removeClass("close").addClass("open"),N(t,e,r-1,a,n));var o=(a?t.rowAttrs:t.colAttrs).length-1;if(!n&&r<o)for(var s,i=r+1,u=(l=i)<=(s=o);u?l<=s:l>=s;u?l++:l--)A(e,a,l).removeClass("open").addClass("close");var i=a?t.rowKeys:t.colKeys,d=_(i,r);for(l in d){var p=d[l],p=T(e,a,p);n===p.hasClass("close")&&p.trigger("click")}return null},M=(r,a,n)=>function(t){var e=t.target.className.match(a?/row(\d+)/:/col(\d+)/);if(e)return n(t.target,a,r,+e[1])};F=(e,r,a)=>function(t){return N(e,W(t.target).closest("table"),r+1,a,W(t.target).hasClass("close")),W(t.target).toggleClass("open close")}}(jQuery);
//# sourceMappingURL=pivot.min.js.map
