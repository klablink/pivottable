{"version":3,"sources":["plotly_renderers.js"],"names":["callWithJQueryAndPlotty","pivotModule","exports","_typeof","module","require","define","amd","jQuery","Plotly","$","makePlotlyChart","traceOptions","layoutOptions","transpose","pivotData","opts","extend","localeStrings","vs","by","plotly","plotlyConfig","rowKeys","getRowKeys","colKeys","getColKeys","traceKeys","datumKeys","length","push","fullAggName","aggregatorName","data","valAttrs","concat","join","map","traceKey","values","labels","_i","_Array$from","Array","from","datumKey","val","parseFloat","getAggregator","value","isFinite","trace","name","type","x","y","groupByTitle","hAxisTitle","rowAttrs","colAttrs","titleText","layout","title","hovermode","width","window","innerWidth","height","innerHeight","i","columns","Math","ceil","sqrt","rows","grid","d","domain","row","floor","column","showlegend","xaxis","automargin","yaxis","result","appendTo","newPlot","detach","pivotUtilities","plotly_renderers","Horizontal Bar Chart","orientation","barmode","Horizontal Stacked Bar Chart","Bar Chart","Stacked Bar Chart","Line Chart","Area Chart","stackgroup","Scatter Chart","text","mode","_i2","_Array$from2","rowKey","_i3","_Array$from3","colKey","v","renderArea","style","remove","Multiple Pie Chart","scalegroup","hoverinfo","textinfo"],"mappings":"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","file":"plotly_renderers.min.js","sourcesContent":["// TODO: This file was created by bulk-decaffeinate.\n// Sanity-check the conversion and remove this comment.\n/*\n * decaffeinate suggestions:\n * DS101: Remove unnecessary use of Array.from\n * DS102: Remove unnecessary code created because of implicit returns\n * DS207: Consider shorter variations of null checks\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\n */\n\nconst callWithJQueryAndPlotty = function(pivotModule) {\n    if ((typeof exports === \"object\") && (typeof module === \"object\")) { // CommonJS\n        return pivotModule(require(\"jquery\"), require(\"plotly.js\"));\n    } else if ((typeof define === \"function\") && define.amd) { // AMD\n        return define([\"jquery\", \"plotly.js\"], pivotModule);\n        // Plain browser env\n    } else {\n        return pivotModule(jQuery, Plotly);\n    }\n};\n\ncallWithJQueryAndPlotty(function($, Plotly) {\n\n    const makePlotlyChart = function(traceOptions, layoutOptions, transpose) {\n        if (traceOptions == null) { traceOptions = {}; }\n        if (layoutOptions == null) { layoutOptions = {}; }\n        if (transpose == null) { transpose = false; }\n        return function(pivotData, opts) {\n            let groupByTitle, hAxisTitle;\n            const defaults = {\n                localeStrings: {vs: \"vs\", by: \"by\"},\n                plotly: {},\n                plotlyConfig: {}\n            };\n\n            opts = $.extend(true, {}, defaults, opts);\n\n            const rowKeys = pivotData.getRowKeys();\n            const colKeys = pivotData.getColKeys();\n            const traceKeys = transpose ? colKeys : rowKeys;\n            if (traceKeys.length === 0) { traceKeys.push([]); }\n            const datumKeys = transpose ? rowKeys : colKeys;\n            if (datumKeys.length === 0) { datumKeys.push([]); }\n\n            let fullAggName = pivotData.aggregatorName;\n            if (pivotData.valAttrs.length) {\n                fullAggName += `(${pivotData.valAttrs.join(\", \")})`;\n            }\n\n            const data = traceKeys.map(function(traceKey) {\n                const values = [];\n                const labels = [];\n                for (var datumKey of Array.from(datumKeys)) {\n                    var val = parseFloat(pivotData.getAggregator(\n                        transpose ? datumKey : traceKey,\n                        transpose ? traceKey : datumKey\n                    ).value());\n                    values.push(isFinite(val) ? val : null);\n                    labels.push(datumKey.join('-') || ' ');\n                }\n\n                const trace = {name: traceKey.join('-') || fullAggName};\n                if (traceOptions.type === \"pie\") {\n                    trace.values = values;\n                    trace.labels = labels.length > 1 ? labels : [fullAggName];\n                } else {\n                    trace.x = transpose ? values : labels;\n                    trace.y = transpose ? labels : values;\n                }\n                return $.extend(trace, traceOptions);\n            });\n\n            if (transpose) {\n                hAxisTitle = pivotData.rowAttrs.join(\"-\");\n                groupByTitle = pivotData.colAttrs.join(\"-\");\n            } else {\n                hAxisTitle = pivotData.colAttrs.join(\"-\");\n                groupByTitle = pivotData.rowAttrs.join(\"-\");\n            }\n            let titleText = fullAggName;\n            if (hAxisTitle !== \"\") { titleText += ` ${opts.localeStrings.vs} ${hAxisTitle}`; }\n            if (groupByTitle !== \"\") { titleText += ` ${opts.localeStrings.by} ${groupByTitle}`; }\n\n            const layout = {\n                title: titleText,\n                hovermode: 'closest',\n                width: window.innerWidth / 1.4,\n                height: (window.innerHeight / 1.4) - 50\n            };\n\n            if (traceOptions.type === 'pie') {\n                const columns = Math.ceil(Math.sqrt(data.length));\n                const rows = Math.ceil(data.length / columns);\n                layout.grid = {columns, rows};\n                for (var i in data) {\n                    var d = data[i];\n                    d.domain = {\n                        row: Math.floor(i / columns),\n                        column: i - (columns * Math.floor(i / columns)),\n                    };\n                    if (data.length > 1) {\n                        d.title = d.name;\n                    }\n                }\n                if (data[0].labels.length === 1) { layout.showlegend = false; }\n            } else {\n                layout.xaxis = {\n                    title: transpose ? fullAggName : null,\n                    automargin: true\n                };\n                layout.yaxis = {\n                    title: transpose ? null : fullAggName,\n                    automargin: true\n                };\n            }\n\n\n            const result = $(\"<div>\").appendTo($(\"body\"));\n            Plotly.newPlot(result[0], data, $.extend(layout, layoutOptions, opts.plotly), opts.plotlyConfig);\n            return result.detach();\n        };\n    };\n\n    const makePlotlyScatterChart = () => (function(pivotData, opts) {\n        const defaults = {\n            localeStrings: {vs: \"vs\", by: \"by\"},\n            plotly: {},\n            plotlyConfig: {}\n        };\n\n        opts = $.extend(true, {}, defaults, opts);\n\n        const rowKeys = pivotData.getRowKeys();\n        if (rowKeys.length === 0) { rowKeys.push([]); }\n        const colKeys = pivotData.getColKeys();\n        if (colKeys.length === 0) { colKeys.push([]); }\n\n        const data = {x: [], y: [], text: [], type: 'scatter', mode: 'markers'};\n\n        for (var rowKey of Array.from(rowKeys)) {\n            for (var colKey of Array.from(colKeys)) {\n                var v = pivotData.getAggregator(rowKey, colKey).value();\n                if (v != null) {\n                    data.x.push(colKey.join('-'));\n                    data.y.push(rowKey.join('-'));\n                    data.text.push(v);\n                }\n            }\n        }\n\n        const layout = {\n            title: pivotData.rowAttrs.join(\"-\") + ' vs ' + pivotData.colAttrs.join(\"-\"),\n            hovermode: 'closest',\n            xaxis: {title: pivotData.colAttrs.join('-'), automargin: true},\n            yaxis: {title: pivotData.rowAttrs.join('-'), automargin: true},\n            width: window.innerWidth / 1.5,\n            height: (window.innerHeight / 1.4) - 50\n        };\n\n        const renderArea = $(\"<div>\", {style: \"display:none;\"}).appendTo($(\"body\"));\n        const result = $(\"<div>\").appendTo(renderArea);\n        Plotly.newPlot(result[0], [data], $.extend(layout, opts.plotly), opts.plotlyConfig);\n        result.detach();\n        renderArea.remove();\n        return result;\n    });\n\n    return $.pivotUtilities.plotly_renderers = {\n        \"Horizontal Bar Chart\": makePlotlyChart({type: 'bar', orientation: 'h'},\n            {barmode: 'group'}, true),\n        \"Horizontal Stacked Bar Chart\": makePlotlyChart({type: 'bar', orientation: 'h'},\n            {barmode: 'relative'}, true),\n        \"Bar Chart\": makePlotlyChart({type: 'bar'}, {barmode: 'group'}),\n        \"Stacked Bar Chart\": makePlotlyChart({type: 'bar'}, {barmode: 'relative'}),\n        \"Line Chart\": makePlotlyChart(),\n        \"Area Chart\": makePlotlyChart({stackgroup: 1}),\n        \"Scatter Chart\": makePlotlyScatterChart(),\n        'Multiple Pie Chart': makePlotlyChart(\n            {type: 'pie', scalegroup: 1, hoverinfo: 'label+value', textinfo: 'none'},\n            {}, true)\n    };\n});\n"]}