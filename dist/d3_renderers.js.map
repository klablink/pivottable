{"version":3,"file":"d3_renderers.js","names":["callWithJQueryAndD3","pivotModule","exports","_typeof","module","require","define","amd","jQuery","d3","$","pivotUtilities","d3_renderers","Treemap","pivotData","opts","value","defaults","localeStrings","width","window","height","extend","result","css","tree","name","children","addToTree","path","length","x","shift","_iterator","_createForOfIteratorHelper","_step","s","n","done","child","err","e","f","newChild","push","_iterator2","getRowKeys","_step2","rowKey","getAggregator","color","scale","category10","treemap","layout","size","sticky","d","select","append","style","datum","selectAll","data","padding","nodes","enter","attr","text","call","y","Math","max","dx","dy"],"sources":["d3_renderers.js"],"sourcesContent":["// noinspection JSUnresolvedReference,NpmUsedModulesInstalled\n\n/** global: jQuery, define, d3 */\n\nconst callWithJQueryAndD3 = function(pivotModule) {\n    if ((typeof exports === 'object') && (typeof module === 'object')) { // CommonJS\n        return pivotModule(require('jquery'), require('d3'));\n    } else if ((typeof define === 'function') && define.amd) { // AMD\n        return define(['jquery', 'd3'], pivotModule);\n        // Plain browser env\n    } else {\n        return pivotModule(jQuery, d3);\n    }\n};\n\ncallWithJQueryAndD3(($, d3) => $.pivotUtilities.d3_renderers = {\n    Treemap(pivotData, opts) {\n        let value;\n        const defaults = {\n            localeStrings: {},\n            d3: {\n                width() {\n                    return $(window).width() / 1.4;\n                },\n                height() {\n                    return $(window).height() / 1.4;\n                },\n            },\n        };\n\n        opts = $.extend(true, {}, defaults, opts);\n\n\n        const result = $('<div>').css({ width: '100%', height: '100%' });\n\n        const tree = { name: 'All', children: [] };\n        const addToTree = function (tree, path, value) {\n            if (path.length === 0) {\n                tree.value = value;\n                return;\n            }\n            if (tree.children == null) {\n                tree.children = [];\n            }\n            const x = path.shift();\n            for (let child of tree.children) {\n                if (child.name === x) {\n                    addToTree(child, path, value);\n                    return;\n                }\n            }\n            const newChild = { name: x };\n            addToTree(newChild, path, value);\n            return tree.children.push(newChild);\n        };\n\n        for (let rowKey of pivotData.getRowKeys()) {\n            value = pivotData.getAggregator(rowKey, []).value();\n            if (value != null) {\n                addToTree(tree, rowKey, value);\n            }\n        }\n\n        const color = d3.scale.category10();\n        const width = opts.d3.width();\n        const height = opts.d3.height();\n\n        const treemap = d3.layout.treemap()\n            .size([width, height])\n            .sticky(true)\n            .value(d => d.size);\n\n        d3.select(result[0])\n            .append('div')\n            .style('position', 'relative')\n            .style('width', width + 'px')\n            .style('height', height + 'px')\n            .datum(tree).selectAll('.node')\n            .data(treemap.padding([15, 0, 0, 0]).value(d => d.value).nodes)\n            .enter().append('div')\n            .attr('class', 'node')\n            .style('background', function (d) {\n                if (d.children != null) {\n                    return 'lightgrey';\n                } else {\n                    return color(d.name);\n                }\n            })\n            .text(d => d.name)\n            .call(function () {\n                this.style('left', d => d.x + 'px')\n                    .style('top', d => d.y + 'px')\n                    .style('width', d => Math.max(0, d.dx - 1) + 'px')\n                    .style('height', d => Math.max(0, d.dy - 1) + 'px');\n            });\n\n        return result;\n    },\n});\n\n\n\n"],"mappings":"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","ignoreList":[]}