{"version":3,"file":"d3_renderers.js","names":["callWithJQuery","$","d3","pivotUtilities","d3_renderers","Treemap","pivotData","opts","value","defaults","localeStrings","width","window","height","extend","result","css","tree","name","children","addToTree","path","length","x","shift","_i","_Array$from","Array","from","child","newChild","push","_i2","_Array$from2","getRowKeys","rowKey","getAggregator","color","scale","category10","treemap","layout","size","sticky","d","select","append","style","datum","selectAll","data","padding","nodes","enter","attr","text","call","y","Math","max","dx","dy"],"sources":["d3_renderers.js"],"sourcesContent":["// TODO: This file was created by bulk-decaffeinate.\n// Sanity-check the conversion and remove this comment.\n/*\n * decaffeinate suggestions:\n * DS101: Remove unnecessary use of Array.from\n * DS102: Remove unnecessary code created because of implicit returns\n * DS207: Consider shorter variations of null checks\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\n */\n\ncallWithJQuery(($, d3) => $.pivotUtilities.d3_renderers = { Treemap(pivotData, opts) {\n    let value;\n    const defaults = {\n        localeStrings: {},\n        d3: {\n            width() { return $(window).width() / 1.4; },\n            height() { return $(window).height() / 1.4; }\n        }\n    };\n\n    opts = $.extend(true, {}, defaults, opts);\n\n\n    const result = $(\"<div>\").css({width: \"100%\", height: \"100%\"});\n\n    const tree = {name: \"All\", children: []};\n    var addToTree = function(tree, path, value) {\n        if (path.length === 0) {\n            tree.value = value;\n            return;\n        }\n        if (tree.children == null) { tree.children = []; }\n        const x = path.shift();\n        for (var child of Array.from(tree.children)) {\n            if (child.name === x) {\n                addToTree(child, path, value);\n                return;\n            }\n        }\n        const newChild = {name: x};\n        addToTree(newChild, path, value);\n        return tree.children.push(newChild);\n    };\n\n    for (var rowKey of Array.from(pivotData.getRowKeys())) {\n        value = pivotData.getAggregator(rowKey, []).value();\n        if (value != null) {\n            addToTree(tree, rowKey, value);\n        }\n    }\n\n    const color = d3.scale.category10();\n    const width = opts.d3.width();\n    const height = opts.d3.height();\n\n    const treemap = d3.layout.treemap()\n        .size([width, height])\n        .sticky(true)\n        .value( d => d.size);\n\n    d3.select(result[0])\n        .append(\"div\")\n            .style(\"position\", \"relative\")\n            .style(\"width\", width + \"px\")\n            .style(\"height\", height + \"px\")\n        .datum(tree).selectAll(\".node\")\n            .data(treemap.padding([15,0,0,0]).value( d => d.value).nodes)\n        .enter().append(\"div\")\n        .attr(\"class\", \"node\")\n        .style(\"background\", function(d) { if (d.children != null) { return \"lightgrey\"; } else { return color(d.name); }  })\n        .text( d => d.name)\n        .call(function() {\n                this.style(\"left\",  d => d.x+\"px\")\n                    .style(\"top\",   d => d.y+\"px\")\n                    .style(\"width\", d => Math.max(0, d.dx - 1)+\"px\")\n                    .style(\"height\",d => Math.max(0, d.dy - 1)+\"px\");\n    });\n\n    return result;\n}\n});\n\n\n\n"],"mappings":"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","ignoreList":[]}