{"version":3,"file":"d3_renderers.js","names":["callWithJQueryAndD3","pivotModule","exports","module","require","define","amd","jQuery","d3","$","pivotUtilities","d3_renderers","Treemap","pivotData","opts","value","defaults","localeStrings","width","window","height","extend","result","css","tree","name","children","addToTree","path","length","x","shift","child","newChild","push","rowKey","getRowKeys","getAggregator","color","scale","category10","treemap","layout","size","sticky","d","select","append","style","datum","selectAll","data","padding","nodes","enter","attr","text","call","y","Math","max","dx","dy"],"sources":["d3_renderers.js"],"sourcesContent":["// noinspection JSUnresolvedReference,NpmUsedModulesInstalled\n\n/** global: jQuery, define, d3 */\n\nconst callWithJQueryAndD3 = function(pivotModule) {\n    if ((typeof exports === 'object') && (typeof module === 'object')) { // CommonJS\n        return pivotModule(require('jquery'), require('d3'));\n    } else if ((typeof define === 'function') && define.amd) { // AMD\n        return define(['jquery', 'd3'], pivotModule);\n        // Plain browser env\n    } else {\n        return pivotModule(jQuery, d3);\n    }\n};\n\ncallWithJQueryAndD3(($, d3) => $.pivotUtilities.d3_renderers = {\n    Treemap(pivotData, opts) {\n        let value;\n        const defaults = {\n            localeStrings: {},\n            d3: {\n                width() {\n                    return $(window).width() / 1.4;\n                },\n                height() {\n                    return $(window).height() / 1.4;\n                },\n            },\n        };\n\n        opts = $.extend(true, {}, defaults, opts);\n\n\n        const result = $('<div>').css({ width: '100%', height: '100%' });\n\n        const tree = { name: 'All', children: [] };\n        const addToTree = function (tree, path, value) {\n            if (path.length === 0) {\n                tree.value = value;\n                return;\n            }\n            if (tree.children == null) {\n                tree.children = [];\n            }\n            const x = path.shift();\n            for (let child of tree.children) {\n                if (child.name === x) {\n                    addToTree(child, path, value);\n                    return;\n                }\n            }\n            const newChild = { name: x };\n            addToTree(newChild, path, value);\n            return tree.children.push(newChild);\n        };\n\n        for (let rowKey of pivotData.getRowKeys()) {\n            value = pivotData.getAggregator(rowKey, []).value();\n            if (value != null) {\n                addToTree(tree, rowKey, value);\n            }\n        }\n\n        const color = d3.scale.category10();\n        const width = opts.d3.width();\n        const height = opts.d3.height();\n\n        const treemap = d3.layout.treemap()\n            .size([width, height])\n            .sticky(true)\n            .value(d => d.size);\n\n        d3.select(result[0])\n            .append('div')\n            .style('position', 'relative')\n            .style('width', width + 'px')\n            .style('height', height + 'px')\n            .datum(tree).selectAll('.node')\n            .data(treemap.padding([15, 0, 0, 0]).value(d => d.value).nodes)\n            .enter().append('div')\n            .attr('class', 'node')\n            .style('background', function (d) {\n                if (d.children != null) {\n                    return 'lightgrey';\n                } else {\n                    return color(d.name);\n                }\n            })\n            .text(d => d.name)\n            .call(function () {\n                this.style('left', d => d.x + 'px')\n                    .style('top', d => d.y + 'px')\n                    .style('width', d => Math.max(0, d.dx - 1) + 'px')\n                    .style('height', d => Math.max(0, d.dy - 1) + 'px');\n            });\n\n        return result;\n    },\n});\n\n\n\n"],"mappings":"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","ignoreList":[]}