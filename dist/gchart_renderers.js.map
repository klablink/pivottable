{"version":3,"file":"gchart_renderers.js","names":["$","makeGoogleChart","chartType","extraOptions","pivotData","opts","agg","dataArray","dataTable","hAxisTitle","title","vAxisTitle","defaults","localeStrings","vs","by","gchart","extend","width","window","innerWidth","height","innerHeight","rowKeys","getRowKeys","length","push","colKeys","getColKeys","fullAggName","aggregatorName","valAttrs","join","headers","map","h","unshift","numCharsInHAxis","y","tree","tree2","x","parseFloat","format","value","google","visualization","DataTable","addColumn","colAttrs","rowAttrs","type","role","addRows","colKey","row","rowKey","getAggregator","val","isNumeric","toPrecision","toFixed","arrayToDataTable","groupByTitle","options","hAxis","slantedText","vAxis","tooltip","textStyle","fontName","fontSize","minValue","legend","position","chartArea","result","css","wrapper","ChartWrapper","draw","bind","editor","ChartEditor","events","addListener","getChartWrapper","openDialog","pivotUtilities","gchart_renderers","isStacked","jQuery"],"sources":["gchart_renderers.js"],"sourcesContent":["(function($) {\n\n    const makeGoogleChart = (chartType, extraOptions) => (function(pivotData, opts) {\n        let agg, dataArray, dataTable, hAxisTitle, title, vAxisTitle;\n        const defaults = {\n            localeStrings: {\n                vs: 'vs',\n                by: 'by'\n            },\n            gchart: {}\n        };\n\n        opts = $.extend(true, {}, defaults, opts);\n        if (opts.gchart.width == null) { opts.gchart.width = window.innerWidth / 1.4; }\n        if (opts.gchart.height == null) { opts.gchart.height = window.innerHeight / 1.4; }\n\n        const rowKeys = pivotData.getRowKeys();\n        if (rowKeys.length === 0) { rowKeys.push([]); }\n        const colKeys = pivotData.getColKeys();\n        if (colKeys.length === 0) { colKeys.push([]); }\n        let fullAggName = pivotData.aggregatorName;\n        if (pivotData.valAttrs.length) {\n            fullAggName += `(${pivotData.valAttrs.join(', ')})`;\n        }\n        const headers = rowKeys.map((h) => h.join('-'));\n        headers.unshift('');\n\n        let numCharsInHAxis = 0;\n        if (chartType === 'ScatterChart') {\n            dataArray = [];\n            for (var y in pivotData.tree) {\n                var tree2 = pivotData.tree[y];\n                for (var x in tree2) {\n                    agg = tree2[x];\n                     dataArray.push([\n                        parseFloat(x),\n                        parseFloat(y),\n                        fullAggName+': \\n'+agg.format(agg.value())\n                        ]);\n                }\n            }\n            dataTable = new google.visualization.DataTable();\n            dataTable.addColumn('number', pivotData.colAttrs.join('-'));\n            dataTable.addColumn('number', pivotData.rowAttrs.join('-'));\n            dataTable.addColumn({type: 'string', role: 'tooltip'});\n            dataTable.addRows(dataArray);\n            hAxisTitle = pivotData.colAttrs.join('-');\n            vAxisTitle = pivotData.rowAttrs.join('-');\n            title = '';\n        } else {\n            dataArray = [headers];\n            for (var colKey of colKeys) {\n                var row = [colKey.join('-')];\n                numCharsInHAxis += row[0].length;\n                for (var rowKey of rowKeys) {\n                    agg = pivotData.getAggregator(rowKey, colKey);\n                    if (agg.value() != null) {\n                        var val = agg.value();\n                        if ($.isNumeric(val)) {\n                            if (val < 1) {\n                                row.push(parseFloat(val.toPrecision(3)));\n                            } else {\n                                row.push(parseFloat(val.toFixed(3)));\n                            }\n                        } else {\n                            row.push(val);\n                        }\n                    } else { row.push(null); }\n                }\n                dataArray.push(row);\n            }\n\n            dataTable = google.visualization.arrayToDataTable(dataArray);\n\n            title = (vAxisTitle = fullAggName);\n            hAxisTitle = pivotData.colAttrs.join('-');\n            if (hAxisTitle !== '') { title += ` ${opts.localeStrings.vs} ${hAxisTitle}`; }\n            const groupByTitle = pivotData.rowAttrs.join('-');\n            if (groupByTitle !== '') { title += ` ${opts.localeStrings.by} ${groupByTitle}`; }\n        }\n\n        let options = {\n            title,\n            hAxis: {title: hAxisTitle, slantedText: numCharsInHAxis > 50},\n            vAxis: {title: vAxisTitle},\n            tooltip: { textStyle: { fontName: 'Arial', fontSize: 12 } }\n        };\n\n        if (chartType === 'ColumnChart') {\n            options.vAxis.minValue = 0;\n        }\n\n        if (chartType === 'ScatterChart') {\n            options.legend = {position: 'none'};\n            options.chartArea = {'width': '80%', 'height': '80%'};\n\n        } else if ((dataArray[0].length === 2) && (dataArray[0][1] ===  '')) {\n            options.legend = {position: 'none'};\n        }\n\n        options = $.extend(true, {}, options, opts.gchart, extraOptions);\n\n        const result = $('<div>').css({width: '100%', height: '100%'});\n        const wrapper = new google.visualization.ChartWrapper({dataTable, chartType, options});\n        wrapper.draw(result[0]);\n        result.bind('dblclick', function() {\n            const editor = new google.visualization.ChartEditor();\n            google.visualization.events.addListener(editor, 'ok', () => editor.getChartWrapper().draw(result[0]));\n            return editor.openDialog(wrapper);\n        });\n        return result;\n    });\n\n    return $.pivotUtilities.gchart_renderers = {\n        'Line Chart': makeGoogleChart('LineChart'),\n        'Bar Chart': makeGoogleChart('ColumnChart'),\n        'Stacked Bar Chart': makeGoogleChart('ColumnChart', {isStacked: true}),\n        'Area Chart': makeGoogleChart('AreaChart', {isStacked: true}),\n        'Scatter Chart': makeGoogleChart('ScatterChart')\n    };\n})(jQuery);\n"],"mappings":"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","ignoreList":[]}