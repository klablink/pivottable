{"version":3,"file":"gchart_renderers.js","names":["$","makeGoogleChart","chartType","extraOptions","pivotData","opts","agg","dataArray","dataTable","hAxisTitle","title","vAxisTitle","defaults","localeStrings","vs","by","gchart","extend","width","window","innerWidth","height","innerHeight","rowKeys","getRowKeys","length","push","colKeys","getColKeys","fullAggName","aggregatorName","valAttrs","concat","join","headers","map","h","unshift","numCharsInHAxis","y","tree","tree2","x","parseFloat","format","value","google","visualization","DataTable","addColumn","colAttrs","rowAttrs","type","role","addRows","_iterator","_createForOfIteratorHelper","_step","s","n","done","colKey","row","_iterator2","_step2","rowKey","getAggregator","val","isNumeric","toPrecision","toFixed","err","e","f","arrayToDataTable","groupByTitle","options","hAxis","slantedText","vAxis","tooltip","textStyle","fontName","fontSize","minValue","legend","position","chartArea","result","css","wrapper","ChartWrapper","draw","bind","editor","ChartEditor","events","addListener","getChartWrapper","openDialog","pivotUtilities","gchart_renderers","isStacked","jQuery"],"sources":["gchart_renderers.js"],"sourcesContent":["(function($) {\n\n    const makeGoogleChart = (chartType, extraOptions) => (function(pivotData, opts) {\n        let agg, dataArray, dataTable, hAxisTitle, title, vAxisTitle;\n        const defaults = {\n            localeStrings: {\n                vs: 'vs',\n                by: 'by'\n            },\n            gchart: {}\n        };\n\n        opts = $.extend(true, {}, defaults, opts);\n        if (opts.gchart.width == null) { opts.gchart.width = window.innerWidth / 1.4; }\n        if (opts.gchart.height == null) { opts.gchart.height = window.innerHeight / 1.4; }\n\n        const rowKeys = pivotData.getRowKeys();\n        if (rowKeys.length === 0) { rowKeys.push([]); }\n        const colKeys = pivotData.getColKeys();\n        if (colKeys.length === 0) { colKeys.push([]); }\n        let fullAggName = pivotData.aggregatorName;\n        if (pivotData.valAttrs.length) {\n            fullAggName += `(${pivotData.valAttrs.join(', ')})`;\n        }\n        const headers = rowKeys.map((h) => h.join('-'));\n        headers.unshift('');\n\n        let numCharsInHAxis = 0;\n        if (chartType === 'ScatterChart') {\n            dataArray = [];\n            for (var y in pivotData.tree) {\n                var tree2 = pivotData.tree[y];\n                for (var x in tree2) {\n                    agg = tree2[x];\n                     dataArray.push([\n                        parseFloat(x),\n                        parseFloat(y),\n                        fullAggName+': \\n'+agg.format(agg.value())\n                        ]);\n                }\n            }\n            dataTable = new google.visualization.DataTable();\n            dataTable.addColumn('number', pivotData.colAttrs.join('-'));\n            dataTable.addColumn('number', pivotData.rowAttrs.join('-'));\n            dataTable.addColumn({type: 'string', role: 'tooltip'});\n            dataTable.addRows(dataArray);\n            hAxisTitle = pivotData.colAttrs.join('-');\n            vAxisTitle = pivotData.rowAttrs.join('-');\n            title = '';\n        } else {\n            dataArray = [headers];\n            for (var colKey of colKeys) {\n                var row = [colKey.join('-')];\n                numCharsInHAxis += row[0].length;\n                for (var rowKey of rowKeys) {\n                    agg = pivotData.getAggregator(rowKey, colKey);\n                    if (agg.value() != null) {\n                        var val = agg.value();\n                        if ($.isNumeric(val)) {\n                            if (val < 1) {\n                                row.push(parseFloat(val.toPrecision(3)));\n                            } else {\n                                row.push(parseFloat(val.toFixed(3)));\n                            }\n                        } else {\n                            row.push(val);\n                        }\n                    } else { row.push(null); }\n                }\n                dataArray.push(row);\n            }\n\n            dataTable = google.visualization.arrayToDataTable(dataArray);\n\n            title = (vAxisTitle = fullAggName);\n            hAxisTitle = pivotData.colAttrs.join('-');\n            if (hAxisTitle !== '') { title += ` ${opts.localeStrings.vs} ${hAxisTitle}`; }\n            const groupByTitle = pivotData.rowAttrs.join('-');\n            if (groupByTitle !== '') { title += ` ${opts.localeStrings.by} ${groupByTitle}`; }\n        }\n\n        let options = {\n            title,\n            hAxis: {title: hAxisTitle, slantedText: numCharsInHAxis > 50},\n            vAxis: {title: vAxisTitle},\n            tooltip: { textStyle: { fontName: 'Arial', fontSize: 12 } }\n        };\n\n        if (chartType === 'ColumnChart') {\n            options.vAxis.minValue = 0;\n        }\n\n        if (chartType === 'ScatterChart') {\n            options.legend = {position: 'none'};\n            options.chartArea = {'width': '80%', 'height': '80%'};\n\n        } else if ((dataArray[0].length === 2) && (dataArray[0][1] ===  '')) {\n            options.legend = {position: 'none'};\n        }\n\n        options = $.extend(true, {}, options, opts.gchart, extraOptions);\n\n        const result = $('<div>').css({width: '100%', height: '100%'});\n        const wrapper = new google.visualization.ChartWrapper({dataTable, chartType, options});\n        wrapper.draw(result[0]);\n        result.bind('dblclick', function() {\n            const editor = new google.visualization.ChartEditor();\n            google.visualization.events.addListener(editor, 'ok', () => editor.getChartWrapper().draw(result[0]));\n            return editor.openDialog(wrapper);\n        });\n        return result;\n    });\n\n    return $.pivotUtilities.gchart_renderers = {\n        'Line Chart': makeGoogleChart('LineChart'),\n        'Bar Chart': makeGoogleChart('ColumnChart'),\n        'Stacked Bar Chart': makeGoogleChart('ColumnChart', {isStacked: true}),\n        'Area Chart': makeGoogleChart('AreaChart', {isStacked: true}),\n        'Scatter Chart': makeGoogleChart('ScatterChart')\n    };\n})(jQuery);\n"],"mappings":"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","ignoreList":[]}